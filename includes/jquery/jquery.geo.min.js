/*! jQuery Geo - v1.0.0-b2 - 2014-09-16
* http://jquerygeo.com
* Copyright (c) 2014 Ryan Westphal; Licensed MIT */
document.createElement("canvas").getContext||function(){function t(){return this.context_||(this.context_=new m(this))}function e(t,e){var i=k.call(arguments,2);return function(){return t.apply(e,i.concat(k.call(arguments)))}}function i(t,e,i){t.namespaces[e]||t.namespaces.add(e,i,"#default#VML")}function s(t){if(i(t,"g_vml_","urn:schemas-microsoft-com:vml"),i(t,"g_o_","urn:schemas-microsoft-com:office:office"),!t.styleSheets.ex_canvas_){var e=t.createStyleSheet();e.owningElement.id="ex_canvas_",e.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}"}}function o(t){var e=t.srcElement;switch(t.propertyName){case"width":e.getContext().clearRect(),e.style.width=e.attributes.width.nodeValue+"px",e.firstChild.style.width=e.clientWidth+"px";break;case"height":e.getContext().clearRect(),e.style.height=e.attributes.height.nodeValue+"px",e.firstChild.style.height=e.clientHeight+"px"}}function n(t){var e=t.srcElement;e.firstChild&&(e.firstChild.style.width=e.clientWidth+"px",e.firstChild.style.height=e.clientHeight+"px")}function r(){return[[1,0,0],[0,1,0],[0,0,1]]}function a(t,e){for(var i=r(),s=0;3>s;s++)for(var o=0;3>o;o++){for(var n=0,a=0;3>a;a++)n+=t[s][a]*e[a][o];i[s][o]=n}return i}function h(t,e){e.fillStyle=t.fillStyle,e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.shadowBlur=t.shadowBlur,e.shadowColor=t.shadowColor,e.shadowOffsetX=t.shadowOffsetX,e.shadowOffsetY=t.shadowOffsetY,e.strokeStyle=t.strokeStyle,e.globalAlpha=t.globalAlpha,e.font=t.font,e.textAlign=t.textAlign,e.textBaseline=t.textBaseline,e.arcScaleX_=t.arcScaleX_,e.arcScaleY_=t.arcScaleY_,e.lineScale_=t.lineScale_}function c(t){var e=t.indexOf("(",3),i=t.indexOf(")",e+1),s=t.substring(e+1,i).split(",");return(4!=s.length||"a"!=t.charAt(3))&&(s[3]=1),s}function l(t){return parseFloat(t)/100}function _(t,e,i){return Math.min(i,Math.max(e,t))}function u(t){var e,i,s,o,n,r;if(o=parseFloat(t[0])/360%360,0>o&&o++,n=_(l(t[1]),0,1),r=_(l(t[2]),0,1),0==n)e=i=s=r;else{var a=.5>r?r*(1+n):r+n-r*n,h=2*r-a;e=d(h,a,o+1/3),i=d(h,a,o),s=d(h,a,o-1/3)}return"#"+G[Math.floor(255*e)]+G[Math.floor(255*i)]+G[Math.floor(255*s)]}function d(t,e,i){return 0>i&&i++,i>1&&i--,1>6*i?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t}function p(t){if(t in D)return D[t];var e,i=1;if(t+="","#"==t.charAt(0))e=t;else if(/^rgb/.test(t)){for(var s,o=c(t),e="#",n=0;3>n;n++)s=-1!=o[n].indexOf("%")?Math.floor(255*l(o[n])):+o[n],e+=G[_(s,0,255)];i=+o[3]}else if(/^hsl/.test(t)){var o=c(t);e=u(o),i=o[3]}else e=t;return D[t]={color:e,alpha:i}}function g(t){return j[t]||"square"}function m(t){this.m_=r(),this.mStack_=[],this.aStack_=[],this.currentPath_=[],this.strokeStyle="#000",this.fillStyle="#000",this.lineWidth=1,this.lineJoin="miter",this.lineCap="butt",this.miterLimit=1*z,this.globalAlpha=1,this.canvas=t;var e="width:"+t.clientWidth+"px;height:"+t.clientHeight+"px;overflow:hidden;position:absolute",i=t.ownerDocument.createElement("div");i.style.cssText=e,t.appendChild(i);var s=i.cloneNode(!1);s.style.backgroundColor="red",s.style.filter="alpha(opacity=0)",t.appendChild(s),this.element_=i,this.arcScaleX_=1,this.arcScaleY_=1,this.lineScale_=1}function f(t,e,i,s){t.currentPath_.push({type:"bezierCurveTo",cp1x:e.x,cp1y:e.y,cp2x:i.x,cp2y:i.y,x:s.x,y:s.y}),t.currentX_=s.x,t.currentY_=s.y}function v(t,e){var i=p(t.strokeStyle),s=i.color,o=i.alpha*t.globalAlpha,n=t.lineScale_*t.lineWidth;1>n&&(o*=n),e.push("<g_vml_:stroke",' opacity="',o,'"',' joinstyle="',t.lineJoin,'"',' miterlimit="',t.miterLimit,'"',' endcap="',g(t.lineCap),'"',' weight="',n,'px"',' color="',s,'" />')}function x(t,e,i,s){t.fillStyle,t.arcScaleX_,t.arcScaleY_,s.x-i.x,s.y-i.y;var o=p(t.fillStyle),n=o.color,r=o.alpha*t.globalAlpha;e.push('<g_vml_:fill color="',n,'" opacity="',r,'" />')}function y(t,e,i){var s=t.m_;return{x:z*(e*s[0][0]+i*s[1][0]+s[2][0])-I,y:z*(e*s[0][1]+i*s[1][1]+s[2][1])-I}}function b(t){return isFinite(t[0][0])&&isFinite(t[0][1])&&isFinite(t[1][0])&&isFinite(t[1][1])&&isFinite(t[2][0])&&isFinite(t[2][1])}function w(t,e,i){if(b(e)&&(t.m_=e,i)){var s=e[0][0]*e[1][1]-e[0][1]*e[1][0];t.lineScale_=$(P(s))}}function S(t){this.code=this[t],this.message=t+": DOM Exception "+this.code}var A=Math,C=A.round,T=A.sin,M=A.cos,P=A.abs,$=A.sqrt,z=10,I=z/2;+navigator.userAgent.match(/MSIE ([\d.]+)?/)[1];var k=Array.prototype.slice;s(document);var L={init:function(t){var i=t||document;i.createElement("canvas"),i.attachEvent("onreadystatechange",e(this.init_,this,i))},init_:function(t){for(var e=t.getElementsByTagName("canvas"),i=0;e.length>i;i++)this.initElement(e[i])},initElement:function(e){if(!e.getContext){e.getContext=t,s(e.ownerDocument),e.innerHTML="",e.attachEvent("onpropertychange",o),e.attachEvent("onresize",n);var i=e.attributes;i.width&&i.width.specified?e.style.width=i.width.nodeValue+"px":e.width=e.clientWidth,i.height&&i.height.specified?e.style.height=i.height.nodeValue+"px":e.height=e.clientHeight}return e}};L.init();for(var G=[],O=0;16>O;O++)for(var B=0;16>B;B++)G[16*O+B]=O.toString(16)+B.toString(16);var D={},j={butt:"flat",round:"round"},E=m.prototype;E.clearRect=function(){this.textMeasureEl_&&(this.textMeasureEl_.removeNode(!0),this.textMeasureEl_=null),this.element_.innerHTML=""},E.beginPath=function(){this.currentPath_=[]},E.moveTo=function(t,e){var i=y(this,t,e);this.currentPath_.push({type:"moveTo",x:i.x,y:i.y}),this.currentX_=i.x,this.currentY_=i.y},E.lineTo=function(t,e){var i=y(this,t,e);this.currentPath_.push({type:"lineTo",x:i.x,y:i.y}),this.currentX_=i.x,this.currentY_=i.y},E.bezierCurveTo=function(t,e,i,s,o,n){var r=y(this,o,n),a=y(this,t,e),h=y(this,i,s);f(this,a,h,r)},E.quadraticCurveTo=function(t,e,i,s){var o=y(this,t,e),n=y(this,i,s),r={x:this.currentX_+2/3*(o.x-this.currentX_),y:this.currentY_+2/3*(o.y-this.currentY_)},a={x:r.x+(n.x-this.currentX_)/3,y:r.y+(n.y-this.currentY_)/3};f(this,r,a,n)},E.arc=function(t,e,i,s,o,n){i*=z;var r=n?"at":"wa",a=t+M(s)*i-I,h=e+T(s)*i-I,c=t+M(o)*i-I,l=e+T(o)*i-I;a!=c||n||(a+=.125);var _=y(this,t,e),u=y(this,a,h),d=y(this,c,l);this.currentPath_.push({type:r,x:_.x,y:_.y,radius:i,xStart:u.x,yStart:u.y,xEnd:d.x,yEnd:d.y})},E.stroke=function(t){var e=[],i=10,s=10;e.push("<g_vml_:shape",' filled="',!!t,'"',' style="position:absolute;width:',i,"px;height:",s,'px;"',' coordorigin="0,0"',' coordsize="',z*i,",",z*s,'"',' stroked="',!t,'"',' path="');for(var o={x:null,y:null},n={x:null,y:null},r=0;this.currentPath_.length>r;r++){var a,h=this.currentPath_[r];switch(h.type){case"moveTo":a=h,e.push(" m ",C(h.x),",",C(h.y));break;case"lineTo":e.push(" l ",C(h.x),",",C(h.y));break;case"close":e.push(" x "),h=null;break;case"bezierCurveTo":e.push(" c ",C(h.cp1x),",",C(h.cp1y),",",C(h.cp2x),",",C(h.cp2y),",",C(h.x),",",C(h.y));break;case"at":case"wa":e.push(" ",h.type," ",C(h.x-this.arcScaleX_*h.radius),",",C(h.y-this.arcScaleY_*h.radius)," ",C(h.x+this.arcScaleX_*h.radius),",",C(h.y+this.arcScaleY_*h.radius)," ",C(h.xStart),",",C(h.yStart)," ",C(h.xEnd),",",C(h.yEnd))}h&&((null==o.x||h.x<o.x)&&(o.x=h.x),(null==n.x||h.x>n.x)&&(n.x=h.x),(null==o.y||h.y<o.y)&&(o.y=h.y),(null==n.y||h.y>n.y)&&(n.y=h.y))}e.push(' ">'),t?x(this,e,o,n):v(this,e),e.push("</g_vml_:shape>"),this.element_.insertAdjacentHTML("beforeEnd",e.join(""))},E.fill=function(){this.stroke(!0)},E.closePath=function(){this.currentPath_.push({type:"close"})},E.save=function(){var t={};h(this,t),this.aStack_.push(t),this.mStack_.push(this.m_),this.m_=a(r(),this.m_)},E.restore=function(){this.aStack_.length&&(h(this.aStack_.pop(),this),this.m_=this.mStack_.pop())},E.translate=function(t,e){var i=[[1,0,0],[0,1,0],[t,e,1]];w(this,a(i,this.m_),!1)},E.scale=function(t,e){this.arcScaleX_*=t,this.arcScaleY_*=e;var i=[[t,0,0],[0,e,0],[0,0,1]];w(this,a(i,this.m_),!0)};var F=S.prototype=Error();F.INDEX_SIZE_ERR=1,F.DOMSTRING_SIZE_ERR=2,F.HIERARCHY_REQUEST_ERR=3,F.WRONG_DOCUMENT_ERR=4,F.INVALID_CHARACTER_ERR=5,F.NO_DATA_ALLOWED_ERR=6,F.NO_MODIFICATION_ALLOWED_ERR=7,F.NOT_FOUND_ERR=8,F.NOT_SUPPORTED_ERR=9,F.INUSE_ATTRIBUTE_ERR=10,F.INVALID_STATE_ERR=11,F.SYNTAX_ERR=12,F.INVALID_MODIFICATION_ERR=13,F.NAMESPACE_ERR=14,F.INVALID_ACCESS_ERR=15,F.VALIDATION_ERR=16,F.TYPE_MISMATCH_ERR=17,G_vmlCanvasManager=L,CanvasRenderingContext2D=m,DOMException=S}(),this.jsviews||this.jQuery&&jQuery.views||function(t,e){function i(t,e){var i="\\"+t.charAt(0),s="\\"+t.charAt(1),o="\\"+e.charAt(0),n="\\"+e.charAt(1);return V.rTag=y=s+"(?:(?:(\\w+(?=[\\/\\s"+o+"]))|(?:(\\w+)?(:)|(>)|(\\*)))"+"\\s*((?:[^"+o+"]|"+o+"(?!"+n+"))*?)"+"(\\/)?|(?:\\/(\\w+)))"+o,y=RegExp(i+y+n,"g"),b=RegExp("<.*>|"+t+".*"+e),this}function s(t){var i=this,s=i.tmpl.helpers||{};return t=(i.ctx[t]!==e?i.ctx:s[t]!==e?s:l[t]!==e?l:{})[t],"function"!=typeof t?t:function(){return t.apply(i,arguments)}}function o(t,e,i){var s=e.tmpl.converters;return t=s&&s[t]||_[t],t?t.call(e,i):i}function n(t,i,s,o,n){n.props=n.props||{};var r,a=n.props.tmpl,l=i.tmpl.tags,_=i.tmpl.templates,d=arguments,p=l&&l[t]||c[t];return p?(o=o&&i.tmpl.tmpls[o-1],a=a||o||e,n.tmpl=""+a===a?_&&_[a]||h[a]||h(a):a,n.isTag=T,n.converter=s,n.view=i,n.renderContent=u,i.ctx&&w(n.ctx,i.ctx),r=p.apply(n,d.length>5?F.call(d,5):[]),r||(r==e?"":""+r)):""}function r(t,i,o,n,r,a){var h=o.views,c={tmpl:r,path:i,parent:o,data:n,ctx:t,views:x.isArray(n)?[]:{},hlp:s};return x.isArray(h)?h.splice(c.index=a!==e?a:h.length,0,c):h[c.index="_"+G++]=c,c}function a(t,i,s,o,n){var r,a;if(s&&"object"==typeof s&&!s.nodeType){for(r in s)i(r,s[r]);return t}return s&&o!==e?""+s===s&&(null===o?delete i[s]:(o=n?n(s,o):o)&&(i[s]=o)):n&&(o=n(e,o||s)),(a=A.onStoreItem)&&a(i,s,o,n),o}function h(t,e){return a(this,h,t,e,m)}function c(t,e){return a(this,c,t,e)}function l(t,e){return a(this,l,t,e)}function _(t,e){return a(this,_,t,e)}function u(t,i,s,o,n){var a,c,l,_,u,d,p,g,m,f,v={},y=n===T,b=this,S="";if(b.isTag?(m=b.tmpl,i=i||b.ctx,s=s||b.view,o=o||b.path,n=n||b.index,v=b.props):m=b.jquery&&b[0]||b,s=s||V.topView,g=s.ctx,f=m.layout,t===s&&(t=s.data,f=T),i=i&&i===g?g:g?(g=w({},g),i?w(g,i):g):i||{},v.link===C&&(i.link=C),m.fn||(m=h[m]||h(m)),u=i.link&&A.onRenderItem,d=i.link&&A.onRenderItems,m){if(x.isArray(t)&&!f)for(_=y?s:n!==e&&s||r(i,o,s,t,m,n),a=0,c=t.length;c>a;a++)l=t[a],p=m.fn(l,r(i,o,_,l,m,(n||0)+a),V),S+=u?u(p,v):p;else _=y?s:r(i,o,s,t,m,n),S+=t||f?m.fn(t,_,V):"";return s.topKey=_.index,d?d(S,o,_.index,m,v):S}return""}function d(){throw"Syntax error"}function p(t,e,i){function s(e){e-=$,e&&O.push(t.substr($,e).replace(z,"\\n"))}function o(e,o,r,a,h,c,l,_,u,d){h&&(a=":",r="html");var p="",m="",f=!_&&!a;if(o=o||a,s(d),$=d+e.length,c?A&&O.push(["*",l.replace(I,"$1")]):o?("else"===o&&(B[5]=t.substring(B[5],d),B=G.pop(),O=B[3],f=T),l=l?g(l,i).replace(L,function(t,e,i){return e?m+=i+",":p+=i+",",""}):"",p=p.slice(0,-1),l=l.slice(0,-1),n=[o,r||"",l,f&&[],"{"+(p?"props:{"+p+"},":"")+"path:'"+l+"'"+(m?",ctx:{"+m.slice(0,-1)+"}":"")+"}"],f&&(G.push(B),B=n,B[5]=$),O.push(n)):u&&(B[5]=t.substring(B[5],d),B=G.pop()),!B)throw"Expected block tag";O=B[3]}var n,r,a,h,c,l,_,u,d,m,v,x,b,w,S,A,C=e?{allowCode:A=e.allowCode,debug:e.debug}:{},M=e&&e.tmpls,P=[],$=0,G=[],O=P,B=[,,,P],D=0;for(t=t.replace(k,"\\$1"),t.replace(y,o),s(t.length),h=P.length,c=h?"":'"";',a=0;h>a;a++)r=P[a],"*"===r[0]?c=c.slice(0,a?-1:-3)+";"+r[1]+(h>a+1?"ret+=":""):""+r===r?c+='"'+r+'"+':(v=r[0],x=r[1],b=r[2],O=r[3],w=r[4],t=r[5],O&&(S=f(t,C,e,D++),p(t,S),M.push(S)),m=m||w.indexOf("view")>-1,c+=(":"===v?"html"===x?(_=T,"e("+b):x?(d=T,'c("'+x+'",view,'+b):(u=T,"((v="+b+')!=u?v:""'):(l=T,'t("'+v+'",view,"'+(x||"")+'",'+(O?M.length:'""')+","+w+(b?",":"")+b))+")+");return c=Function("data, view, j, b, u",j+(u?"v,":"")+(l?"t=j.tag,":"")+(d?"c=j.convert,":"")+(_?"e=j.converters.html,":"")+"ret; try{\n\n"+(C.debug?"debugger;":"")+(A?"ret=":"return ")+c.slice(0,-1)+";\n\n"+(A?"return ret;":"")+"}catch(e){return j.err(e);}"),e&&(e.fn=c,e.useVw=d||m||l),c}function g(t,i){function s(t,s,c,l,_,u,p,g,m,f,v,x,y,b,w,S){function A(t,e,s,o,n,r,a){if(e){var h=(s?'view.hlp("'+s+'")':o?"view":"data")+(a?(n?"."+n:s?"":o?"":"."+e)+(r||""):(a=s?"":o?n||"":e,""));return i&&"("!==m&&(h="b("+h+',"'+a+'")'),h+(a?"."+a:"")}return t}return _=_||"",c=c||s||v,l=l||g,m=m||w||"",_=_||"",u?(d(),e):h?(h=!x,h?t:'"'):a?(a=!y,a?t:'"'):(c?(r++,c):"")+(S?r?"":o?(o=C,"\b"):",":p?(r&&d(),o=T,"\b"+l+":"):l?l.replace(P,A)+(m?(n[++r]=T,m):_):_?t:b?(n[r--]=C,b+(m?(n[++r]=T,m):"")):f?(n[r]||d(),","):s?"":(h=x,a=y,'"'))}var o,n={},r=0,a=C,h=C;return t=(t+" ").replace($,s)}function m(t,i,s,o){function n(i){return""+i===i||i.nodeType>0?(a=i.nodeType>0?i:!b.test(i)&&M&&M(i)[0],a&&a.type&&(i=h[a.getAttribute(D)],i||(t=t||"_"+O++,a.setAttribute(D,t),i=m(t,a.innerHTML,s,o),h[t]=i)),i):e}var r,a,c,l,_;if(r=n(i),o=o||(i.markup?i:{}),o.name=t,l=o.templates,!r&&i.markup&&(r=n(i.markup))&&(!r.fn||r.debug===i.debug&&r.allowCode===i.allowCode||(r=r.markup)),r!==e){t&&!s&&(R[t]=function(){return i.render.apply(i,arguments)}),r.fn||i.fn?r.fn&&(i=t&&t!==r.name?w(w({},r),o):r):(i=f(r,o,s,0),p(r,i));for(c in l)_=l[c],_.name!==c&&(l[c]=m(c,_,i));return i}}function f(t,e,i,s){function o(t){i[t]&&(n[t]=w(w({},i[t]),e[t]))}e=e||{};var n={markup:t,tmpls:[],links:[],render:u};return i&&(i.templates&&(n.templates=w(w({},i.templates),e.templates)),n.parent=i,n.name=i.name+"["+s+"]",n.index=s),w(n,e),i&&(o("templates"),o("tags"),o("helpers"),o("converters")),n}function v(t){return B[t]||(B[t]="&#"+t.charCodeAt(0)+";")}var x,y,b,w,S="v1.0pre",A={},C=!1,T=!0,M=t.jQuery,P=/^(?:null|true|false|\d[\d.]*|([\w$]+|~([\w$]+)|#(view|([\w$]+))?)([\w$.]*?)(?:[.[]([\w$]+)\]?)?|(['"]).*\8)$/g,$=/(\()(?=|\s*\()|(?:([([])\s*)?(?:([#~]?[\w$.]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*!:?\/]|(=))\s*|([#~]?[\w$.]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*([)\]])([([]?))|(\s+)/g,z=/\r?\n/g,I=/\\(['"])/g,k=/\\?(['"])/g,L=/\x08(~)?([^\x08]+)\x08/g,G=0,O=0,B={"&":"&amp;","<":"&lt;",">":"&gt;"},D="data-jsv-tmpl",j="var j=j||"+(M?"jQuery.":"js")+"views,",E=/[\x00"&'<>]/g,F=Array.prototype.slice,R={},V={jsviews:S,sub:A,debugMode:T,err:function(t){return V.debugMode?"<br/><b>Error:</b> <em> "+(t.message||t)+". </em>":'""'},tmplFn:p,render:R,templates:h,tags:c,helpers:l,converters:_,View:r,convert:o,delimiters:i,tag:n};M?(x=M,x.templates=h,x.render=R,x.views=V,x.fn.render=u):(x=t.jsviews=V,x.extend=function(t,e){var i;t=t||{};for(i in e)t[i]=e[i];return t},x.isArray=Array&&Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}),w=x.extend,V.topView={views:{},tmpl:{},hlp:s,ctx:V.helpers},c({"if":function(){var t=this,i=t.view;return i.onElse=function(t,s){for(var o=0,n=s.length;n&&!s[o++];)if(o===n)return"";return i.onElse=e,t.path="",t.renderContent(i)},i.onElse(this,arguments)},"else":function(){var t=this.view;return t.onElse?t.onElse(this,arguments):""},"for":function(){var t,e=this,i="",s=arguments,o=s.length;for(e.props.layout&&(e.tmpl.layout=T),t=0;o>t;t++)i+=e.renderContent(s[t]);return i},"=":function(t){return t},"*":function(t){return t}}),_({html:function(t){return t!=e?(t+"").replace(E,v):""}}),i("{{","}}")}(this),function(t){function e(e){var i=e||window.event,s=[].slice.call(arguments,1),o=0,n=0,r=0;return e=t.event.fix(i),e.type="mousewheel",i.wheelDelta&&(o=i.wheelDelta/120),i.detail&&(o=-i.detail/3),r=o,void 0!==i.axis&&i.axis===i.HORIZONTAL_AXIS&&(r=0,n=-1*o),void 0!==i.wheelDeltaY&&(r=i.wheelDeltaY/120),void 0!==i.wheelDeltaX&&(n=-1*i.wheelDeltaX/120),s.unshift(e,o,n,r),(t.event.dispatch||t.event.handle).apply(this,s)}var i=["DOMMouseScroll","mousewheel"];if(t.event.fixHooks)for(var s=i.length;s;)t.event.fixHooks[i[--s]]=t.event.mouseHooks;t.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var t=i.length;t;)this.addEventListener(i[--t],e,!1);else this.onmousewheel=e},teardown:function(){if(this.removeEventListener)for(var t=i.length;t;)this.removeEventListener(i[--t],e,!1);else this.onmousewheel=null}},t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}(jQuery),$.widget||function(t,e){if(t.cleanData){var i=t.cleanData;t.cleanData=function(e){for(var s,o=0;null!=(s=e[o]);o++)try{t(s).triggerHandler("remove")}catch(n){}i(e)}}else{var s=t.fn.remove;t.fn.remove=function(e,i){return this.each(function(){return i||(!e||t.filter(e,[this]).length)&&t("*",this).add([this]).each(function(){try{t(this).triggerHandler("remove")}catch(e){}}),s.call(t(this),e,i)})}}t.widget=function(e,i,s){var o,n=e.split(".")[0];e=e.split(".")[1],o=n+"-"+e,s||(s=i,i=t.Widget),t.expr[":"][o]=function(i){return!!t.data(i,e)},t[n]=t[n]||{},t[n][e]=function(t,e){arguments.length&&this._createWidget(t,e)};var r=new i;r.options=t.extend(!0,{},r.options),t[n][e].prototype=t.extend(!0,r,{namespace:n,widgetName:e,widgetEventPrefix:t[n][e].prototype.widgetEventPrefix||e,widgetBaseClass:o},s),t.widget.bridge(e,t[n][e])},t.widget.bridge=function(i,s){t.fn[i]=function(o){var n="string"==typeof o,r=Array.prototype.slice.call(arguments,1),a=this;return o=!n&&r.length?t.extend.apply(null,[!0,o].concat(r)):o,n&&"_"===o.charAt(0)?a:(n?this.each(function(){var s=t.data(this,i),n=s&&t.isFunction(s[o])?s[o].apply(s,r):s;return n!==s&&n!==e?(a=n,!1):e}):this.each(function(){var e=t.data(this,i);e?e.option(o||{})._init():t.data(this,i,new s(o,this))}),a)}},t.Widget=function(t,e){arguments.length&&this._createWidget(t,e)},t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(e,i){t.data(i,this.widgetName,this),this.element=t(i),this.options=t.extend(!0,{},this.options,this._getCreateOptions(),e);var s=this;this.element.bind("remove."+this.widgetName,function(){s.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return t.metadata&&t.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(i,s){var o=i;if(0===arguments.length)return t.extend({},this.options);if("string"==typeof i){if(s===e)return this.options[i];o={},o[i]=s}return this._setOptions(o),this},_setOptions:function(e){var i=this;return t.each(e,function(t,e){i._setOption(t,e)}),this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&this.widget()[e?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",e),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(e,i,s){var o,n,r=this.options[e];if(s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],n=i.originalEvent)for(o in n)o in i||(i[o]=n[o]);return this.element.trigger(i,s),!(t.isFunction(r)&&r.call(this.element[0],i,s)===!1||i.isDefaultPrevented())}}}(jQuery),function(t,e,i){e.toStaticHTML=e.toStaticHTML||function(t){return t};var s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;t.geo={_allCoordinates:function(e){for(var i=this._flatten(e),s=0,o=[];i.length>s;s++){var n,r,a,h=i[s].coordinates,c=h&&t.isArray(h[0]),l=c&&t.isArray(h[0][0]),_=l&&t.isArray(h[0][0][0]);for(_||(l||(c||(h=[h]),h=[h]),h=[h]),n=0;h.length>n;n++)for(r=0;h[n].length>r;r++)for(a=0;h[n][r].length>a;a++)o.push(h[n][r][a])}return o},_isGeodetic:function(e){for(;t.isArray(e);){if(e.length>1&&!t.isArray(e[0]))return e[0]>=-180.001&&180.001>=e[0]&&e[1]>=-90.001&&90.001>=e[1];e=e[0]}return!1},center:function(e,i){var s=!1;!i&&t.geo.proj&&this._isGeodetic(e)&&(s=!0,e=t.geo.proj.fromGeodetic(e));var o=[(e[0]+e[2])/2,(e[1]+e[3])/2];return s?t.geo.proj.toGeodetic(o):o},expandBy:function(e,i,s,o){var n=!1;return!o&&t.geo.proj&&this._isGeodetic(e)&&(n=!0,e=t.geo.proj.fromGeodetic(e)),e=[e[0]-i,e[1]-s,e[2]+i,e[3]+s],n?t.geo.proj.toGeodetic(e):e},height:function(e,i){return!i&&t.geo.proj&&this._isGeodetic(e)&&(e=t.geo.proj.fromGeodetic(e)),e[3]-e[1]},_in:function(t,e){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[2]&&t[3]>=e[3]},_bboxDisjoint:function(t,e){return e[0]>t[2]||e[2]<t[0]||e[1]>t[3]||e[3]<t[1]},include:function(e,i,n){if(!i||!t.isArray(i))return e;var r=!1;return!n&&t.geo.proj&&this._isGeodetic(e||i)&&(r=!0),e?r&&(e=t.geo.proj.fromGeodetic(e)):e=[s,s,o,o],2===i.length&&(i=[i[0],i[1],i[0],i[1]]),t.geo.proj&&(i=t.geo.proj.fromGeodetic(i)),e[0]=Math.min(i[0],e[0]),e[1]=Math.min(i[1],e[1]),e[2]=Math.max(i[2],e[2]),e[3]=Math.max(i[3],e[3]),r?t.geo.proj.toGeodetic(e):e},polygonize:function(e,i){var s=!1;!i&&t.geo.proj&&this._isGeodetic(e)&&(s=!0,e=t.geo.proj.fromGeodetic(e));var o={type:"Polygon",coordinates:[[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]],[e[0],e[1]]]]};return s&&(o.coordinates=t.geo.proj.toGeodetic(o.coordinates)),o},reaspect:function(e,i,s){var o=!1;!s&&t.geo.proj&&this._isGeodetic(e)&&(o=!0,e=t.geo.proj.fromGeodetic(e));var n,r,a=this.width(e,!0),h=this.height(e,!0),c=this.center(e,!0);return 0!==a&&0!==h&&i>0&&(a/h>i?(n=a/2,r=n/i):(r=h/2,n=r*i),e=[c[0]-n,c[1]-r,c[0]+n,c[1]+r]),o?t.geo.proj.toGeodetic(e):e},recenter:function(e,i,s){var o=!1;!s&&t.geo.proj&&(this._isGeodetic(e)&&(o=!0,e=t.geo.proj.fromGeodetic(e)),this._isGeodetic(i)&&(i=t.geo.proj.fromGeodetic(i)));var n=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return e=[i[0]-n,i[1]-r,i[0]+n,i[1]+r],o?t.geo.proj.toGeodetic(e):e},scaleBy:function(e,i,s){var o=!1;!s&&t.geo.proj&&this._isGeodetic(e)&&(o=!0,e=t.geo.proj.fromGeodetic(e));var n=this.center(e,!0),r=(e[2]-e[0])*i/2,a=(e[3]-e[1])*i/2;return e=[n[0]-r,n[1]-a,n[0]+r,n[1]+a],o?t.geo.proj.toGeodetic(e):e},width:function(e,i){return!i&&t.geo.proj&&this._isGeodetic(e)&&(e=t.geo.proj.fromGeodetic(e)),e[2]-e[0]},bbox:function(e,n){var r,a=!1;if(!e)return i;if(e.bbox)r=!n&&t.geo.proj&&this._isGeodetic(e.bbox)?t.geo.proj.fromGeodetic(e.bbox):e.bbox;else{r=[s,s,o,o];var h=this._allCoordinates(e),c=0;if(0===h.length)return i;for(!n&&t.geo.proj&&this._isGeodetic(h)&&(a=!0,h=t.geo.proj.fromGeodetic(h));h.length>c;c++)r[0]=Math.min(h[c][0],r[0]),r[1]=Math.min(h[c][1],r[1]),r[2]=Math.max(h[c][0],r[2]),r[3]=Math.max(h[c][1],r[3])}return a?t.geo.proj.toGeodetic(r):r},centroid:function(e,n){var r;switch(e.type){case"Point":return t.extend({},e);case"LineString":case"Polygon":var a,h,c=0,l=t.merge([],"Polygon"===e.type?e.coordinates[0]:e.coordinates),_=1,u=[s,s,o,o];r=[0,0];var d=!1;for(!n&&t.geo.proj&&this._isGeodetic(l)&&(d=!0,l=t.geo.proj.fromGeodetic(l));l.length>=_;_++)a=_%l.length,u[0]=Math.min(l[a][0],u[0]),u[1]=Math.min(l[a][1],u[1]),u[2]=Math.max(l[a][0],u[2]),u[3]=Math.max(l[a][1],u[3]),h=l[_-1][0]*l[a][1]-l[a][0]*l[_-1][1],c+=h,r[0]+=(l[_-1][0]+l[a][0])*h,r[1]+=(l[_-1][1]+l[a][1])*h;return 0===c?l.length>0?(r[0]=Math.min(Math.max(l[0][0],u[0]),u[2]),r[1]=Math.min(Math.max(l[0][1],u[1]),u[3]),{type:"Point",coordinates:d?t.geo.proj.toGeodetic(r):r}):i:(c*=3,r[0]=Math.min(Math.max(r[0]/c,u[0]),u[2]),r[1]=Math.min(Math.max(r[1]/c,u[1]),u[3]),{type:"Point",coordinates:d?t.geo.proj.toGeodetic(r):r});case"MultiPoint":if(e.coordinates.length>0)return r=e.coordinates[0],{type:"Point",coordinates:[r[0],r[1]]};break;case"MultiLineString":case"MultiPolygon":if(e.coordinates.length>0)return this.centroid({type:e.type.substr(5),coordinates:e.coordinates[0]},n)}return i},contains:function(t,e){if("Polygon"!==t.type)return!1;switch(e.type){case"Point":return this._containsPolygonPoint(t.coordinates,e.coordinates);case"LineString":return this._containsPolygonLineString(t.coordinates,e.coordinates);case"Polygon":return this._containsPolygonLineString(t.coordinates,e.coordinates[0]);default:return!1}},_containsPolygonPoint:function(t,e){if(0===t.length||4>t[0].length)return!1;for(var i,s,o=0,n=t[0][0],r=1;t[0].length>r;r++)i=t[0][r],(n[1]<=e[1]&&e[1]<i[1]||i[1]<=e[1]&&e[1]<n[1]&&(e[0]<n[0]||e[0]<i[0]))&&(s=n[0]+(i[0]-n[0])*(e[1]-n[1])/(i[1]-n[1]),s>e[0]&&o++),n=i;return 1===o%2},_containsPolygonLineString:function(t,e){for(var i=0;e.length>i;i++)if(!this._containsPolygonPoint(t,e[i]))return!1;return!0},distance:function(e,s,o){var n=!o&&t.geo.proj&&this._isGeodetic(e.coordinates)?t.geo.proj.fromGeodetic(e.coordinates):e.coordinates,r=!o&&t.geo.proj&&this._isGeodetic(s.coordinates)?t.geo.proj.fromGeodetic(s.coordinates):s.coordinates;switch(e.type){case"Point":switch(s.type){case"Point":return this._distancePointPoint(r,n);case"LineString":return this._distanceLineStringPoint(r,n);case"Polygon":return this._containsPolygonPoint(r,n)?0:this._distanceLineStringPoint(r[0],n);default:return i}break;case"LineString":switch(s.type){case"Point":return this._distanceLineStringPoint(n,r);case"LineString":return this._distanceLineStringLineString(n,r);case"Polygon":return this._containsPolygonLineString(r,n)?0:this._distanceLineStringLineString(r[0],n);default:return i}break;case"Polygon":switch(s.type){case"Point":return this._containsPolygonPoint(n,r)?0:this._distanceLineStringPoint(n[0],r);case"LineString":return this._containsPolygonLineString(n,r)?0:this._distanceLineStringLineString(n[0],r);case"Polygon":return this._containsPolygonLineString(n,r[0])?0:this._distanceLineStringLineString(n[0],r[0]);default:return i}}},_distancePointPoint:function(t,e){var i=e[0]-t[0],s=e[1]-t[1];return Math.sqrt(i*i+s*s)},_distanceLineStringPoint:function(t,e){var i=s;if(t.length>0){var o=t[0],n=e[0]-o[0],r=e[1]-o[1];if(1===t.length)return Math.sqrt(n*n+r*r);for(var a=1;t.length>a;a++){var h=t[a],c=h[0]-o[0],l=h[1]-o[1],_=e[0]-h[0],u=e[1]-h[1],d=this._distanceSegmentPoint(c,l,n,r,_,u);if(0===d)return 0;i>d&&(i=d),o=h,n=_,r=u}}return Math.sqrt(i)},_distanceSegmentPoint:function(t,e,i,s,o,n){var r=t*i+e*s;if(0>=r)return i*i+s*s;var a=t*t+e*e;return r>=a?o*o+n*n:i*i+s*s-r*r/a},_distanceLineStringLineString:function(t,e){for(var i=s,o=0;e.length>o;o++)i=Math.min(i,this._distanceLineStringPoint(t,e[o]));return i},_buffer:function(e,s,o){var n=!1,r=e.coordinates;if(!o&&t.geo.proj&&this._isGeodetic(e.coordinates)&&(n=!0,r=t.geo.proj.fromGeodetic(e.coordinates)),"Point"===e.type){for(var a,h=[],c=180,l=0;c>=l;l++)a=360*l/c*(Math.PI/180),h.push([r[0]+Math.cos(a)*s,r[1]+Math.sin(a)*s]);return{type:"Polygon",coordinates:[n?t.geo.proj.toGeodetic(h):h]}}return i},_basic:function(t){for(var e,i,s=[],o=0,n=this._flatten(t);n.length>o;o++)if("Multi"===n[o].type.substring(0,5))for(e=n[o].type.substring(5),i=0;n[o].coordinates.length>i;i++)s.push({type:e,coordinates:n[o].coordinates[i]});else s.push(n[o]);return s},_flatten:function(e){var i=[],s=0;switch(e.type){case"Feature":t.merge(i,this._flatten(e.geometry));break;case"FeatureCollection":for(;e.features.length>s;s++)t.merge(i,this._flatten(e.features[s].geometry));break;case"GeometryCollection":for(;e.geometries.length>s;s++)t.merge(i,this._flatten(e.geometries[s]));break;default:i[0]=e}return i},length:function(e,i){var s,o,n,r=0,a=1;switch(e.type){case"Point":return 0;case"LineString":s=e.coordinates;break;case"Polygon":s=e.coordinates[0]}if(s){for(!i&&t.geo.proj&&this._isGeodetic(s)&&(s=t.geo.proj.fromGeodetic(s));s.length>a;a++)o=s[a][0]-s[a-1][0],n=s[a][1]-s[a-1][1],r+=Math.sqrt(o*o+n*n);return r}},area:function(e,i){var s,o,n=0,r=1;switch(e.type){case"Point":case"LineString":return 0;case"Polygon":s=e.coordinates[0]}if(s){for(!i&&t.geo.proj&&this._isGeodetic(s)&&(s=t.geo.proj.fromGeodetic(s));s.length>=r;r++)o=r%s.length,n+=(s[r-1][0]-s[o][0])*(s[r-1][1]+s[o][1])/2;return Math.abs(n)}},pointAlong:function(e,i,s){var o,n,r,a,h,c,l,_,u=0,d=0,p=0,g=[],m=1,f=!1;switch(e.type){case"Point":return t.extend({},e);case"LineString":r=e.coordinates;break;case"Polygon":r=e.coordinates[0]}if(r){if(0===i)return{type:"Point",coordinates:[r[0][0],r[0][1]]};if(1===i)return m=r.length-1,{type:"Point",coordinates:[r[m][0],r[m][1]]};for(!s&&t.geo.proj&&this._isGeodetic(r)&&(f=!0,r=t.geo.proj.fromGeodetic(r));r.length>m;m++)a=r[m][0]-r[m-1][0],h=r[m][1]-r[m-1][1],n=Math.sqrt(a*a+h*h),g.push(n),u+=n;for(m=0;g.length>m&&i>p;m++)d=p,p+=g[m]/u;return o=i-d,l=r[m-1],_=r[m],c=[l[0]+o*(_[0]-l[0]),l[1]+o*(_[1]-l[1])],{type:"Point",coordinates:f?t.geo.proj.toGeodetic(c):c}}},WKT:function(){function e(t){return"POINT "+i(t.coordinates)}function i(t){return t&&t.length?"("+t.join(" ")+")":"EMPTY"}function s(t){return"LINESTRING "+o(t.coordinates)}function o(t){if(t&&t.length){for(var e=[],i=0;t.length>i;i++)e.push(t[i].join(" "));return"("+e+")"}return"EMPTY"}function n(t){return"POLYGON "+r(t.coordinates)}function r(t){if(t&&t.length){for(var e=[],i=0;t.length>i;i++)e.push(o(t[i]));return"("+e+")"}return"EMTPY"}function a(t){return"MULTIPOINT "+o(t.coordinates)}function h(t){return"MULTILINSTRING "+r(t.coordinates)}function c(t){return"MULTIPOLYGON "+l(t.coordinates)}function l(t){if(t&&t.length){for(var e=[],i=0;t.length>i;i++)e.push(r(t[i]));return"("+e+")"}return"EMPTY"}function _(t){return"GEOMETRYCOLLECTION "+u(t.geometries)}function u(t){if(t&&t.length){for(var e=[],i=0;t.length>i;i++)e.push(d(t[i]));return"("+t+")"}return"EMPTY"}function d(t){if(!t||!t.type)return"";switch(t.type){case"Point":return e(t);case"LineString":return s(t);case"Polygon":return n(t);case"MultiPoint":return a(t);case"MultiLineString":return h(t);case"MultiPolygon":return c(t);case"GeometryCollection":return _(t);default:return""}}function p(t){var e=t.match(/\(\s*([\d\.\-]+)\s+([\d\.\-]+)\s*\)/);return e&&e.length>2?{type:"Point",coordinates:[parseFloat(e[1]),parseFloat(e[2])]}:null}function g(t){var e,i,s=t.match(/\s*\((.*)\)/),o=[],n=0;if(s&&s.length>1){for(e=s[1].match(/[\d\.\-]+\s+[\d\.\-]+/g);e.length>n;n++)i=e[n].match(/\s*([\d\.\-]+)\s+([\d\.\-]+)\s*/),o[n]=[parseFloat(i[1]),parseFloat(i[2])];return{type:"LineString",coordinates:o}}return null}function m(t){var e,i,s=t.match(/\s*\(\s*\((.*)\)\s*\)/),o=[],n=0;if(s&&s.length>1){for(e=s[1].match(/[\d\.\-]+\s+[\d\.\-]+/g);e.length>n;n++)i=e[n].match(/\s*([\d\.\-]+)\s+([\d\.\-]+)\s*/),o[n]=[parseFloat(i[1]),parseFloat(i[2])];return{type:"Polygon",coordinates:[o]}}return null}function f(e){var i;return-1===e.indexOf("((")?i=g(e):(i=v(e),i.coordinates=t.geo._allCoordinates(i)),i.type="MultiPoint",i}function v(t){for(var e,i=t.substr(2,t.length-4),s=i.split(/\),\s*\(/),o=0,n={type:"MultiLineString",coordinates:[]};s.length>o;o++)e=g("("+s[o]+")"),e&&n.coordinates.push(e.coordinates);return n}function x(t){for(var e,i=t.substr(1,t.length-2),s=i.split(/\),\s*\(/),o=0,n={type:"MultiPolygon",coordinates:[]};s.length>o;o++)e=m("("+s[o]+")"),e&&n.coordinates.push(e.coordinates);return n}function y(t){var e,i,s=t.substr(1,t.length-2),o=s.match(/\),[a-zA-Z]/g),n={type:"GeometryCollection",geometries:[]},r=0,a=0;if(o&&o.length>0){for(;o.length>r;r++)i=s.indexOf(o[r],a)-a+1,e=b(s.substr(a,i)),e&&n.geometries.push(e),a+=i+1;return e=b(s.substr(a)),e&&n.geometries.push(e),n}return null}function b(e){e=t.trim(e);var i=e.indexOf("("),s=e.substr(i);switch(t.trim(e.substr(0,i)).toUpperCase()){case"POINT":return p(s);case"LINESTRING":return g(s);case"POLYGON":return m(s);case"MULTIPOINT":return f(s);case"MULTILINESTRING":return v(s);case"MULTIPOLYGON":return x(s);case"GEOMETRYCOLLECTION":return y(s);default:return null}}return{stringify:d,parse:b}}(),proj:function(){var e=1.5707963267948966,i=.7853981633974483,s=.017453292519943295,o=57.29577951308232,n=6378137;return{fromGeodeticPos:function(t){return[n*t[0]*s,n*Math.log(Math.tan(i+t[1]*s/2))]},fromGeodetic:function(e){if(!t.geo._isGeodetic(e))return e;var i=t.isArray(e[0]),s=this.fromGeodeticPos;if(i||4!==e.length){var o,n,r,a=i&&t.isArray(e[0][0]),h=a&&t.isArray(e[0][0][0]),c=[];for(h||(a||(i||(e=[e]),e=[e]),e=[e]),o=0;e.length>o;o++)for(c[o]=[],n=0;e[o].length>n;n++)for(c[o][n]=[],r=0;e[o][n].length>r;r++)c[o][n][r]=s(e[o][n][r]);return h?c:a?c[0]:i?c[0][0]:c[0][0][0]}var l=s([e[0],e[1]]),_=s([e[2],e[3]]);return[l[0],l[1],_[0],_[1]]},toGeodeticPos:function(t){return[t[0]/n*o,(e-2*Math.atan(1/Math.exp(t[1]/n)))*o]
},toGeodetic:function(e){if(t.geo._isGeodetic(e))return e;var i=t.isArray(e[0]),s=this.toGeodeticPos;if(i||4!==e.length){var o,n,r,a=i&&t.isArray(e[0][0]),h=a&&t.isArray(e[0][0][0]),c=[];for(h||(a||(i||(e=[e]),e=[e]),e=[e]),o=0;e.length>o;o++)for(c[o]=[],n=0;e[o].length>n;n++)for(c[o][n]=[],r=0;e[o][n].length>r;r++)c[o][n][r]=s(e[o][n][r]);return h?c:a?c[0]:i?c[0][0]:c[0][0][0]}var l=s([e[0],e[1]]),_=s([e[2],e[3]]);return[l[0],l[1],_[0],_[1]]}}}(),_serviceTypes:{}}}(jQuery,this),function(t,e,i){var s=function(){var t=5,e=document.createElement("div"),i=e.all||[];do e.innerHTML="<!--[if gt IE "+ ++t+"]><br><![endif]-->";while(i[0]);return t>6?t:!t}();t.widget("geo.geographics",{_$elem:i,_options:{},_trueCanvas:!0,_trueDoubleBuffer:!0,_width:0,_height:0,_$canvas:i,_context:i,_$canvasSceneFront:i,_$canvasSceneBack:i,_timeoutEnd:null,_requireFlip:!1,_blitcanvas:i,_blitcontext:i,_$labelsContainerFront:i,_$labelsContainerBack:i,_labelsHtml:"",options:{style:{borderRadius:"8px",color:"#7f0000",fillOpacity:.2,height:"8px",opacity:1,strokeOpacity:1,strokeWidth:"2px",visibility:"visible",width:"8px"},doubleBuffer:!0},_create:function(){this._$elem=this.element,this._options=this.options,this._$elem.css({webkitTransform:"translateZ(0)",display:"inline-block",overflow:"hidden",textAlign:"left"}),"static"===this._$elem.css("position")&&this._$elem.css("position","relative"),this._$elem.addClass("geo-graphics"),this._width=this._$elem.width(),this._height=this._$elem.height(),this._width&&this._height||(this._width=parseInt(this._$elem.css("width"),10),this._height=parseInt(this._$elem.css("height"),10));var i="position:absolute;left:0;top:0;margin:0;padding:0;",o="width:"+this._width+"px;height:"+this._height+"px;",n='width="'+this._width+'" height="'+this._height+'"';this._blitcanvas=document.createElement("canvas"),this._blitcanvas.getContext?(this._$canvas=t(e.toStaticHTML("<canvas "+n+' style="-webkit-transform:translateZ(0);'+i+'"></canvas>')),this._blitcanvas.width=1,this._blitcanvas.height=1,this._trueDoubleBuffer=this._blitcanvas.toDataURL().length>6,this._options.doubleBuffer&&this._trueDoubleBuffer||this._$elem.append(this._$canvas),this._context=this._$canvas[0].getContext("2d"),this._blitcanvas.width=this._width,this._blitcanvas.height=this._height,this._blitcontext=this._blitcanvas.getContext("2d"),this._$canvasSceneFront=t(e.toStaticHTML('<img id="scene0" style="-webkit-transform:translateZ(0);'+i+o+'" />')),this._$canvasSceneBack=t(e.toStaticHTML('<img id="scene1" style="-webkit-transform:translateZ(0);'+i+o+'" />'))):8>=s&&(this._trueCanvas=!1,this._$elem.append("<div "+n+' style="'+i+o+'"></div>'),this._$canvas=this._$elem.children(":last"),G_vmlCanvasManager.initElement(this._$canvas[0]),this._context=this._$canvas[0].getContext("2d"),this._$canvas.children().css({backgroundColor:"transparent",width:this._width,height:this._height})),this._$labelsContainerFront=t(e.toStaticHTML('<div class="geo-labels-container" style="-webkit-transform:translateZ(0);'+i+o+'"></div>')),this._$labelsContainerBack=t(e.toStaticHTML('<div class="geo-labels-container" style="-webkit-transform:translateZ(0);'+i+o+'"></div>'))},_setOption:function(e,i){"style"===e&&(i=t.extend({},this._options.style,i)),t.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){t.Widget.prototype.destroy.apply(this,arguments),this._$elem.html(""),this._$elem.removeClass("geo-graphics")},clear:function(){this._context.clearRect(0,0,this._width,this._height),this._labelsHtml="",this._end()},drawArc:function(t,e,i,s){if(s=this._getGraphicStyle(s),"hidden"!==s.visibility&&s.opacity>0&&s.widthValue>0&&s.heightValue>0){var o=Math.min(s.widthValue,s.heightValue)/2;e=e*Math.PI/180,i=i*Math.PI/180,this._context.save(),this._context.translate(t[0],t[1]),s.widthValue>s.heightValue?this._context.scale(s.widthValue/s.heightValue,1):this._context.scale(1,s.heightValue/s.widthValue),this._context.beginPath(),this._context.arc(0,0,o,e,i,!1),this._trueCanvas&&this._context.restore(),s.doFill&&(this._context.fillStyle=s.fill,this._context.globalAlpha=s.opacity*s.fillOpacity,this._context.fill()),s.doStroke&&(this._context.lineJoin="round",this._context.lineWidth=s.strokeWidthValue,this._context.strokeStyle=s.stroke,this._context.globalAlpha=s.opacity*s.strokeOpacity,this._context.stroke()),this._trueCanvas||this._context.restore()}this._end()},drawPoint:function(t,e){e=this._getGraphicStyle(e),e.widthValue===e.heightValue&&e.heightValue===e.borderRadiusValue?this.drawArc(t,0,360,e):"hidden"!==e.visibility&&e.opacity>0&&(e.borderRadiusValue=Math.min(Math.min(e.widthValue,e.heightValue)/2,e.borderRadiusValue),t[0]-=e.widthValue/2,t[1]-=e.heightValue/2,this._context.beginPath(),this._context.moveTo(t[0]+e.borderRadiusValue,t[1]),this._context.lineTo(t[0]+e.widthValue-e.borderRadiusValue,t[1]),this._context.quadraticCurveTo(t[0]+e.widthValue,t[1],t[0]+e.widthValue,t[1]+e.borderRadiusValue),this._context.lineTo(t[0]+e.widthValue,t[1]+e.heightValue-e.borderRadiusValue),this._context.quadraticCurveTo(t[0]+e.widthValue,t[1]+e.heightValue,t[0]+e.widthValue-e.borderRadiusValue,t[1]+e.heightValue),this._context.lineTo(t[0]+e.borderRadiusValue,t[1]+e.heightValue),this._context.quadraticCurveTo(t[0],t[1]+e.heightValue,t[0],t[1]+e.heightValue-e.borderRadiusValue),this._context.lineTo(t[0],t[1]+e.borderRadiusValue),this._context.quadraticCurveTo(t[0],t[1],t[0]+e.borderRadiusValue,t[1]),this._context.closePath(),e.doFill&&(this._context.fillStyle=e.fill,this._context.globalAlpha=e.opacity*e.fillOpacity,this._context.fill()),e.doStroke&&(this._context.lineJoin="round",this._context.lineWidth=e.strokeWidthValue,this._context.strokeStyle=e.stroke,this._context.globalAlpha=e.opacity*e.strokeOpacity,this._context.stroke()),this._end())},drawLineString:function(t,e){this._drawLines([t],!1,e)},drawPolygon:function(t,e){if(this._trueCanvas&&1!==t.length){if(!t||!t.length||3>t[0].length)return;e=this._getGraphicStyle(e);var i,s,o;if("hidden"!==e.visibility&&e.opacity>0){if(this._blitcontext.clearRect(0,0,this._width,this._height),e.doFill&&t.length>1)for(this._blitcontext.globalCompositeOperation="source-out",this._blitcontext.globalAlpha=1,s=1;t.length>s;s++){for(this._blitcontext.beginPath(),this._blitcontext.moveTo(t[s][0][0],t[s][0][1]),o=1;t[s].length>o;o++)this._blitcontext.lineTo(t[s][o][0],t[s][o][1]);this._blitcontext.closePath(),this._blitcontext.fill()}for(this._blitcontext.beginPath(),this._blitcontext.moveTo(t[0][0][0],t[0][0][1]),i=[t[0][0][0]-e.strokeWidthValue,t[0][0][1]-e.strokeWidthValue,t[0][0][0]+e.strokeWidthValue,t[0][0][1]+e.strokeWidthValue],s=1;t[0].length-1>s;s++)this._blitcontext.lineTo(t[0][s][0],t[0][s][1]),i[0]=Math.min(t[0][s][0]-e.strokeWidthValue,i[0]),i[1]=Math.min(t[0][s][1]-e.strokeWidthValue,i[1]),i[2]=Math.max(t[0][s][0]+e.strokeWidthValue,i[2]),i[3]=Math.max(t[0][s][1]+e.strokeWidthValue,i[3]);if(this._blitcontext.closePath(),this._blitcontext.globalCompositeOperation="source-out",e.doFill&&(this._blitcontext.fillStyle=e.fill,this._blitcontext.globalAlpha=e.opacity*e.fillOpacity,this._blitcontext.fill()),this._blitcontext.globalCompositeOperation="source-over",e.doStroke&&(this._blitcontext.lineCap=this._blitcontext.lineJoin="round",this._blitcontext.lineWidth=e.strokeWidthValue,this._blitcontext.strokeStyle=e.stroke,this._blitcontext.globalAlpha=e.opacity*e.strokeOpacity,this._blitcontext.stroke(),t.length>1))for(s=1;t.length>s;s++){for(this._blitcontext.beginPath(),this._blitcontext.moveTo(t[s][0][0],t[s][0][1]),o=1;t[s].length>o;o++)this._blitcontext.lineTo(t[s][o][0],t[s][o][1]);this._blitcontext.closePath(),this._blitcontext.stroke()}i[0]=Math.min(Math.max(i[0],0),this._width),i[1]=Math.min(Math.max(i[1],0),this._height),i[2]=Math.min(Math.max(i[2],0),this._width),i[3]=Math.min(Math.max(i[3],0),this._height),i[0]!==i[2]&&i[1]!==i[3]&&(this._context.drawImage(this._blitcanvas,i[0],i[1],i[2]-i[0],i[3]-i[1],i[0],i[1],i[2]-i[0],i[3]-i[1]),this._end())}}else this._drawLines(t,!0,e)},drawBbox:function(t,e){this._drawLines([[[t[0],t[1]],[t[0],t[3]],[t[2],t[3]],[t[2],t[1]],[t[0],t[1]]]],!0,e)},drawLabel:function(t,e){this._labelsHtml+='<div class="geo-label" style="-webkit-transform:translateZ(0);position:absolute; left:'+100*(t[0]/this._width)+"%; top:"+100*(t[1]/this._height)+'%;">'+e+"</div>"},resize:function(t,e){this._width=this._$elem.width(),this._height=this._$elem.height(),this._width&&this._height||(this._width=parseInt(this._$elem.css("width"),10),this._height=parseInt(this._$elem.css("height"),10)),this._trueCanvas?(this._$canvas[0].width=this._width,this._$canvas[0].height=this._height,this._$canvasSceneFront.css({left:t,top:e}),this._$canvasSceneBack.css({width:this._width,height:this._height})):this._$canvas.css({width:this._width,height:this._height});var i=this._$labelsContainerFront.position();this._$labelsContainerFront.css({left:i.left+t,top:i.top+e,width:this._width,height:this._height}),this._$labelsContainerBack.css({width:this._width,height:this._height})},interactiveTransform:function(t,e){if(this._timeoutEnd&&(clearTimeout(this._timeoutEnd),this._timeoutEnd=null),this._trueCanvas)if(this._options.doubleBuffer&&this._trueDoubleBuffer){var i=this;if(this._requireFlip){i._requireFlip=!1;var s=i._$canvasSceneFront;i._$canvasSceneFront=i._$canvasSceneBack.css({left:0,top:0,width:i._width,height:i._height}).prop("src",i._$canvas[0].toDataURL()).prependTo(i._$elem),i._$canvasSceneBack=s.prop("src","").detach()}this._$canvasSceneFront.css({left:Math.round(t[0]),top:Math.round(t[1]),width:this._width*e,height:this._height*e})}else this._context.clearRect(0,0,this._width,this._height);else this._context.clearRect(0,0,this._width,this._height);this._$labelsContainerFront.css({left:Math.round(t[0]),top:Math.round(t[1]),width:this._width*e,height:this._height*e})},_canvasSceneLoad:function(){var t=this;if(t._requireFlip){t._requireFlip=!1;var e=t._$canvasSceneFront;t._$canvasSceneFront=t._$canvasSceneBack.css({left:0,top:0,width:t._width,height:t._height}).prependTo(t._$elem),t._$canvasSceneBack=e.prop("src","").detach()}},_endCallback:function(){var t=this;if(t._timeoutEnd){t._trueCanvas&&t._options.doubleBuffer&&t._trueDoubleBuffer&&(t._$canvasSceneBack.prop("src",t._$canvas[0].toDataURL()),this._canvasSceneLoad()),t._$labelsContainerBack.html(e.toStaticHTML(t._labelsHtml)).find("a").css({position:"relative",zIndex:1,display:"inline-block",webkitTransform:"translateZ(0)"});var i=t._$labelsContainerFront;t._$labelsContainerFront=t._$labelsContainerBack.css({left:0,top:0,width:t._width,height:t._height}).appendTo(t._$elem),t._$labelsContainerBack=i.detach(),t._timeoutEnd=null}},_end:function(){this._timeoutEnd&&(clearTimeout(this._timeoutEnd),this._timeoutEnd=null),this._requireFlip=!0,this._timeoutEnd=setTimeout(t.proxy(this._endCallback,this),20)},_getGraphicStyle:function(e){function i(t){return t=parseInt(t,10),+t+""===t?+t:t}return e=t.extend({},this._options.style,e),e.borderRadiusValue=i(e.borderRadius),e.fill=e.fill||e.color,e.doFill=e.fill&&e.fillOpacity>0,e.stroke=e.stroke||e.color,e.strokeWidthValue=i(e.strokeWidth),e.doStroke=e.stroke&&e.strokeOpacity>0&&e.strokeWidthValue>0,e.widthValue=i(e.width),e.heightValue=i(e.height),e},_drawLines:function(t,e,i){if(t&&t.length&&!(2>t[0].length)){var s,o;if(i=this._getGraphicStyle(i),"hidden"!==i.visibility&&i.opacity>0){for(this._context.beginPath(),s=0;t.length>s;s++)for(this._context.moveTo(t[s][0][0],t[s][0][1]),o=1;t[s].length>o;o++)this._context.lineTo(t[s][o][0],t[s][o][1]);e&&this._context.closePath(),e&&i.doFill&&(this._context.fillStyle=i.fill,this._context.globalAlpha=i.opacity*i.fillOpacity,this._context.fill()),i.doStroke&&(this._context.lineCap=this._context.lineJoin="round",this._context.lineWidth=i.strokeWidthValue,this._context.strokeStyle=i.stroke,this._context.globalAlpha=i.opacity*i.strokeOpacity,this._context.stroke()),this._end()}}}})}(jQuery,window),function(t,e,i){var s=0,o=function(){var t=5,e=document.createElement("div"),i=e.all||[];do e.innerHTML="<!--[if gt IE "+ ++t+"]><br><![endif]-->";while(i[0]);return t>6?t:!t}(),n={bbox:[-180,-85,180,85],bboxMax:[-180,-85,180,85],center:[0,0],cursors:{"static":"default",pan:"url(data:image/vnd.microsoft.icon;base64,AAACAAEAICACAAgACAAwAQAAFgAAACgAAAAgAAAAQAAAAAEAAQAAAAAAAAEAAAAAAAAAAAAAAgAAAAAAAAAAAAAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD8AAAA/AAAAfwAAAP+AAAH/gAAB/8AAA//AAAd/wAAGf+AAAH9gAADbYAAA2yAAAZsAAAGbAAAAGAAAAAAAAA//////////////////////////////////////////////////////////////////////////////////////gH///4B///8Af//+AD///AA///wAH//4AB//8AAf//AAD//5AA///gAP//4AD//8AF///AB///5A////5///8=), move",click:"crosshair",zoom:"crosshair",dragBox:"crosshair",dragCircle:"crosshair",drawPoint:"crosshair",drawLineString:"crosshair",drawPolygon:"crosshair",measureLength:"crosshair",measureArea:"crosshair"},measureLabels:{length:"{{:length.toFixed( 2 )}} m",area:"{{:area.toFixed( 2 )}} sq m"},drawStyle:{},shapeStyle:{},mode:"pan",pannable:!0,scroll:"default",shift:"default",services:[{"class":"osm",type:"tiled",src:function(t){return"//otile"+(t.index%4+1)+("https:"===location.protocol?"-s":"")+".mqcdn.com/tiles/1.0.0/osm/"+t.zoom+"/"+t.tile.column+"/"+t.tile.row+".png"},attr:"Tiles Courtesy of <a href='http://www.mapquest.com/' target='_blank'>MapQuest</a> <img src='//developer.mapquest.com/content/osm/mq_logo.png'>"}],tilingScheme:{tileWidth:256,tileHeight:256,levels:18,basePixelSize:156543.03392799935,origin:[-20037508.342787,20037508.342787]},axisLayout:"map",zoom:0,zoomMin:0,zoomMax:Number.POSITIVE_INFINITY,zoomFactor:2,pixelSize:0};t.widget("geo.geomap",{_$elem:i,_map:i,_created:!1,_createdGraphics:!1,_widgetId:0,_tmplLengthId:"",_tmplAreaId:"",_contentBounds:{},_$resizeContainer:i,_$eventTarget:i,_$contentFrame:i,_$existingChildren:i,_$attrList:i,_$servicesContainer:i,_$shapesContainers:i,_$panContainer:i,_$shapesContainer:i,_$drawContainer:i,_$measureContainer:i,_$measureLabel:i,_dpi:96,_currentServices:[],_center:i,_pixelSize:i,_centerMax:i,_pixelSizeMax:i,_pixelSizeMin:i,_userGeodetic:!0,_centerInteractive:i,_pixelSizeInteractive:i,_timeoutInteractive:null,_triggerInteractive:!1,_timeoutRefreshShapes:null,_loadCount:0,_wheelLevel:0,_fullZoomFactor:2,_partialZoomFactor:1.18920711500273,_mouseDown:i,_inOp:i,_toolPan:i,_shiftDown:i,_anchor:i,_current:i,_downDate:i,_moveDate:i,_clickDate:i,_lastMove:i,_lastDrag:i,_windowHandler:null,_resizeTimeout:null,_panning:i,_velocity:i,_friction:i,_supportTouch:i,_softDblClick:i,_isTap:i,_isDbltap:i,_isMultiTouch:i,_multiTouchAnchor:[],_multiTouchAnchorBbox:i,_multiTouchCurrentBbox:i,_drawTimeout:null,_drawPixels:[],_drawCoords:[],_graphicShapes:[],_initOptions:{},_options:{},options:t.extend({},n),_createWidget:function(e,o){if(this._$elem=t(o),this._$elem.is(".geo-service"))return this._graphicShapes=[],t.Widget.prototype._createWidget.apply(this,arguments),i;this._widgetId=s++,this._serviceIdSeed=0,this._tmplLengthId="geoMeasureLength"+this._widgetId,this._tmplAreaId="geoMeasureArea"+this._widgetId,this._$elem.addClass("geo-map").css({webkitTransform:"translateZ(0)"}),this._initOptions=e||{},this._forcePosition(this._$elem),this._$elem.css("text-align","left");var n=this._findMapSize();this._contentBounds={x:parseInt(this._$elem.css("padding-left"),10),y:parseInt(this._$elem.css("padding-top"),10),width:n.width,height:n.height},this._createChildren(),this._center=[0,0],this._centerMax=[0,0],this._centerInteractive=[0,0],this.options.pixelSize=this._pixelSize=this._pixelSizeMax=156543.03392799935,this._pixelSizeMin=this._pixelSizeMax/Math.pow(2,17),this._mouseDown=this._inOp=this._toolPan=this._shiftDown=this._panning=this._isTap=this._isDbltap=!1,this._anchor=[0,0],this._current=[0,0],this._lastMove=[0,0],this._lastDrag=[0,0],this._velocity=[0,0],this._friction=[.8,.8],this._downDate=this._moveDate=this._clickDate=0,this._drawPixels=[],this._drawCoords=[],this._graphicShapes=[],t.Widget.prototype._createWidget.apply(this,arguments)},_create:function(){if(this._options=this.options,this._$elem.is(".geo-service"))return this._map=this._$elem.data("geoMap"),this._$elem.data("geoService",this),i;this._map=this,this._supportTouch="ontouchend"in document,this._softDblClick=this._supportTouch||7===o;var s=this,n=this._supportTouch?"touchstart mousedown":"mousedown",r=this._supportTouch?"touchend touchcancel mouseup":"mouseup",a=this._supportTouch?"touchmove mousemove":"mousemove";t(document).keydown(t.proxy(this._document_keydown,this)),this._$eventTarget.dblclick(t.proxy(this._eventTarget_dblclick,this)),this._$eventTarget.bind(n,t.proxy(this._eventTarget_touchstart,this));var h=this._$eventTarget[0].setCapture?this._$eventTarget:t(document);h.bind(a,t.proxy(this._dragTarget_touchmove,this)),h.bind(r,t.proxy(this._dragTarget_touchstop,this)),this._$eventTarget.mousewheel(t.proxy(this._eventTarget_mousewheel,this)),this._windowHandler=function(){s._resizeTimeout&&clearTimeout(s._resizeTimeout),s._resizeTimeout=setTimeout(function(){s._created&&s._$elem.geomap("resize",!0)},500)},t(e).resize(this._windowHandler),this._$drawContainer.geographics({style:this._initOptions.drawStyle||{},doubleBuffer:!1}),this._options.drawStyle=this._$drawContainer.geographics("option","style"),this._$shapesContainer.geographics({style:this._initOptions.shapeStyle||{}}),this._createdGraphics=!0,this._options.shapeStyle=this._$shapesContainer.geographics("option","style"),this._initOptions&&(this._initOptions.tilingScheme!==i&&this._setOption("tilingScheme",this._initOptions.tilingScheme||null,!1),this._initOptions.services&&(this._options.services=t.merge([],this._initOptions.services)),this._initOptions.bboxMax&&(this._setOption("bboxMax",this._initOptions.bboxMax,!1),this._setOption("bbox",this._initOptions.bboxMax,!1)),this._initOptions.zoomMin!==i&&this._setOption("zoomMin",this._initOptions.zoomMin,!1),this._initOptions.zoomMax!==i&&this._setOption("zoomMax",this._initOptions.zoomMax,!1),this._initOptions.zoomFactor!==i&&(this._setOption("zoomFactor",this._initOptions.zoomFactor,!1),this._fullZoomFactor=this._initOptions.zoomFactor,this._partialZoomFactor=Math.pow(4,1/this._fullZoomFactor)),this._initOptions.bbox&&this._setOption("bbox",this._initOptions.bbox,!1),this._initOptions.center&&this._setOption("center",this._initOptions.center,!1),this._initOptions.zoom!==i&&this._setOption("zoom",this._initOptions.zoom,!1)),t.templates(this._tmplLengthId,this._options.measureLabels.length),t.templates(this._tmplAreaId,this._options.measureLabels.area),this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]),this._createServices(),this._refresh(),this._created=!0},_setOption:function(e,s,o){if("pixelSize"!==e){o=o===i||o,this._$elem.is(".geo-map")&&this._panFinalize();var n,r,a,h;switch(e){case"bbox":this._created&&this._clearInteractiveTimeout(),this._userGeodetic="map"===this._options.axisLayout&&t.geo.proj&&t.geo._isGeodetic(s),this._userGeodetic&&(s=t.geo.proj.fromGeodetic(s)),n=[s[0]+(s[2]-s[0])/2,s[1]+(s[3]-s[1])/2],r=Math.max(t.geo.width(s,!0)/this._contentBounds.width,t.geo.height(s,!0)/this._contentBounds.height),h=this._getZoom(n,r),this._options.tilingScheme?r=this._getPixelSize(Math.min(Math.max(h,this._options.zoomMin),this._options.zoomMax)):this._options.zoomMin>h?r=this._getPixelSize(this._options.zoomMin):h>this._options.zoomMax&&(r=this._getPixelSize(this._options.zoomMax)),this._created?(this._setInteractiveCenterAndSize(n,r),this._setInteractiveTimeout(!1)):this._setCenterAndSize(n,r,!1,o),s=this._getBbox(n,r);break;case"bboxMax":this._userGeodetic="map"===this._options.axisLayout&&t.geo.proj&&t.geo._isGeodetic(s);break;case"center":this._created&&this._clearInteractiveTimeout(),this._userGeodetic="map"===this._options.axisLayout&&t.geo.proj&&t.geo._isGeodetic(s),this._userGeodetic&&(s=t.geo.proj.fromGeodetic(s)),this._created?(this._setInteractiveCenterAndSize(s,this._pixelSizeInteractive),this._interactiveTransform(),this._setInteractiveTimeout(!1)):this._setCenterAndSize(s,this._pixelSize,!1,o);break;case"measureLabels":s=t.extend(this._options.measureLabels,s),t.templates(this._tmplLengthId,this._options.measureLabels.length),t.templates(this._tmplAreaId,this._options.measureLabels.area);break;case"drawStyle":this._$drawContainer&&(this._$drawContainer.geographics("option","style",s),s=this._$drawContainer.geographics("option","style"));break;case"shapeStyle":this._$elem.is(".geo-service")&&!this._createdGraphics&&this._createServiceGraphics(),this._createdGraphics&&(this._$shapesContainer.geographics("option","style",s),s=this._$shapesContainer.geographics("option","style"));break;case"mode":this._resetDrawing(),this._$eventTarget.css("cursor",this._options.cursors[s]);break;case"zoom":this._created?this._setZoom(s,!1,o):(s=Math.max(s,0),this._setCenterAndSize(this._center,this._getPixelSize(s),!1,o))}switch(t.Widget.prototype._setOption.apply(this,arguments),e){case"bbox":case"center":this._userGeodetic&&(this._options.bbox=t.geo.proj.toGeodetic(this._options.bbox),this._options.center=t.geo.proj.toGeodetic(this._center));break;case"tilingScheme":null!==s&&(this._pixelSizeMax=this._getPixelSize(0),this._pixelSizeMin=this._getPixelSize(s.pixelSizes?s.pixelSizes.length-1:s.levels-1),this._centerMax=[s.origin[0]+this._pixelSizeMax*s.tileWidth/2,s.origin[1]+this._pixelSizeMax*s.tileHeight/2]);break;case"bboxMax":a=this._userGeodetic?t.geo.proj.fromGeodetic(s):s,this._centerMax=t.geo.center(a),this._pixelSizeMax=Math.max(t.geo.width(a,!0)/this._contentBounds.width,t.geo.height(a,!0)/this._contentBounds.height),this._pixelSizeMin=1;break;case"services":this._createServices(),o&&(this._refresh(),this._refreshAllShapes());break;case"shapeStyle":o&&this._createdGraphics&&(this._$shapesContainer.geographics("clear"),this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes))}}},destroy:function(){if(this._$elem.is(".geo-service"))this._createdGraphics&&(this._$shapesContainer.geographics("destroy"),this._$shapesContainer=i,this._createdGraphics=!1);else{clearTimeout(this._timeoutInteractive),this._timeoutInteractive=null,this._created=!1,t(e).unbind("resize",this._windowHandler);for(var s=0;this._currentServices.length>s;s++)this._currentServices[s].serviceContainer.geomap("destroy"),t.geo._serviceTypes[this._currentServices[s].type].destroy(this,this._$servicesContainer,this._currentServices[s]);this._$shapesContainer.geographics("destroy"),this._$shapesContainer=i,this._createdGraphics=!1,this._$drawContainer.geographics("destroy"),this._$drawContainer=i,this._$existingChildren.detach(),this._$elem.html(""),this._$elem.append(this._$existingChildren),this._$elem.removeClass("geo-map")}t.Widget.prototype.destroy.apply(this,arguments)},toMap:function(e){return e=this._toMap(e),this._userGeodetic?t.geo.proj.toGeodetic(e):e},toPixel:function(e,i,s){return this._toPixel(t.geo.proj?t.geo.proj.fromGeodetic(e):e,i,s)},opacity:function(e,i){if(this._$elem.is(".geo-service"))this._$elem.closest(".geo-map").geomap("opacity",e,this._$elem);else if(e>=0||1>=e)for(var s=0;this._currentServices.length>s;s++){var o=this._currentServices[s];i&&o.serviceContainer[0]!==i[0]||(o.style.opacity=e,o.serviceObject.style=t.extend({},o.serviceObject.style,o.style),t.geo._serviceTypes[o.type].opacity(this,o))}},toggle:function(e,s){if(this._$elem.is(".geo-service"))this._$elem.closest(".geo-map").geomap("toggle",e,this._$elem);else for(var o=0;this._currentServices.length>o;o++){var n=this._currentServices[o];s&&n.serviceContainer[0]!==s[0]||(e===i&&(e="visible"!==n.style.visibility),n.style.visibility=e?"visible":"hidden",n.serviceObject.style=t.extend({},n.serviceObject.style,n.style),n.serviceContainer.toggle(e),e&&t.geo._serviceTypes[n.type].refresh(this,n))}},zoom:function(t){null!==t&&this._setZoom(this._options.zoom+t,!1,!0)},refresh:function(t,e){this._$elem.is(".geo-service")?this._$elem.closest(".geo-map").geomap("refresh",t,this._$elem):(this._refresh(t,e),this._refreshAllShapes())},resize:function(e){var i,s=this._findMapSize(),o=s.width/2-this._contentBounds.width/2,n=s.height/2-this._contentBounds.height/2;for(this._contentBounds={x:parseInt(this._$elem.css("padding-left"),10),y:parseInt(this._$elem.css("padding-top"),10),width:s.width,height:s.height},this._$resizeContainer.css({width:s.width,height:s.height}),i=0;this._currentServices.length>i;i++)t.geo._serviceTypes[this._currentServices[i].type].resize(this,this._currentServices[i],o,n);for(this._$elem.find(".geo-graphics").css({width:s.width,height:s.height}).geographics("resize",o,n),i=0;this._drawPixels.length>i;i++)this._drawPixels[i][0]+=o,this._drawPixels[i][1]+=n;this._setCenterAndSize(this._center,this._pixelSize,e,!0)},append:function(e){if(e&&(t.isPlainObject(e)||t.isArray(e)&&e.length>0)){this._createdGraphics||this._createServiceGraphics();var s,o,n,r,a,h;for(s=t.isArray(e)?e:"FeatureCollection"===e.type?e.features:[e],n=1;arguments.length>n;n++)o=arguments[n],null!==o&&("object"==typeof o?r=o:"number"==typeof o||"string"==typeof o?a=o:"boolean"==typeof o&&(h=o));for(n=0;s.length>n;n++){if(!t.data(s[n],"geoBbox")){var c=t.geo.bbox(s[n]);t.geo.proj&&t.geo._isGeodetic(c)&&(c=t.geo.proj.fromGeodetic(c)),t.data(s[n],"geoBbox",c)}this._graphicShapes.push({shape:s[n],style:r,label:a})}(h===i||h)&&(this._$elem.is(".geo-service")?this._refresh(!1,this._$elem):this._refresh(),this._refreshAllShapes())}},empty:function(t){this._graphicShapes=[],(t===i||t)&&(this._$elem.is(".geo-service")?this._refresh(!1,this._$elem):this._refresh(),this._refreshAllShapes())},find:function(e,i){for(var s,o,n,r=t.isPlainObject(e),a=this._map._pixelSize*i,h=[],c=0;this._graphicShapes.length>c;c++)if(s=this._graphicShapes[c],r)if("Point"===s.shape.type)a>=t.geo.distance(s.shape,e)&&h.push(s.shape);else{var l=t.data(s.shape,"geoBbox"),_={type:"Polygon",coordinates:[[[l[0],l[1]],[l[0],l[3]],[l[2],l[3]],[l[2],l[1]],[l[0],l[1]]]]},u={type:"Point",coordinates:t.geo.proj&&t.geo._isGeodetic(e.coordinates)?t.geo.proj.fromGeodetic(e.coordinates):e.coordinates};if(a>=t.geo.distance(_,u,!0))for(o=t.geo._basic(s.shape),n=0;o.length>n;n++)if(a>=t.geo.distance(o[n],e)){h.push(s.shape);break}}else h.push(s.shape);return this._$elem.is(".geo-map")&&this._$elem.find(".geo-service").each(function(){h=t.merge(h,t(this).geomap("find",e,i))}),h},remove:function(e,s){if(e&&(t.isPlainObject(e)||t.isArray(e)&&e.length>0)){for(var o,n=t.isArray(e)?e:[e],r=0;this._graphicShapes.length>r;r++)t.inArray(this._graphicShapes[r].shape,n)>=0&&(o=this._graphicShapes.slice(r+1),this._graphicShapes.length=r,this._graphicShapes.push.apply(this._graphicShapes,o),r--);(s===i||s)&&(this._$elem.is(".geo-service")?this._refresh(!1,this._$elem):this._refresh(),this._refreshAllShapes())}},_getBbox:function(t,e){t=t||this._center,e=e||this._pixelSize;var i=this._contentBounds.width/2*e,s=this._contentBounds.height/2*e;return[t[0]-i,t[1]-s,t[0]+i,t[1]+s]},_setBbox:function(e){var i=[e[0]+(e[2]-e[0])/2,e[1]+(e[3]-e[1])/2],s=Math.max(t.geo.width(e,!0)/this._contentBounds.width,t.geo.height(e,!0)/this._contentBounds.height),o=this._getZoom(i,s);this._options.tilingScheme?s=this._getPixelSize(Math.min(Math.max(o,this._options.zoomMin),this._options.zoomMax)):this._options.zoomMin>o?s=this._getPixelSize(this._options.zoomMin):o>this._options.zoomMax&&(s=this._getPixelSize(this._options.zoomMax)),this._setInteractiveCenterAndSize(i,s),this._interactiveTransform()},_getBboxMax:function(){var t=this._contentBounds.width/2*this._pixelSizeMax,e=this._contentBounds.height/2*this._pixelSizeMax;return[this._centerMax[0]-t,this._centerMax[1]-e,this._centerMax[0]+t,this._centerMax[1]+e]},_getCenter:function(){return this._center},_getContentBounds:function(){return this._contentBounds},_getServicesContainer:function(){return this._$servicesContainer},_getZoom:function(e,i){e=e||this._center,i=i||this._pixelSize;var s=this._options.tilingScheme;if(s){if(s.pixelSizes){for(var o=Math.floor(1e3*i),n=s.pixelSizes.length,r=n-1;r>=0;r--)if(Math.floor(1e3*s.pixelSizes[r])>=o)return r;return 0}return Math.round(Math.log(s.basePixelSize/i)/Math.log(2))}var a=this._contentBounds.width/this._contentBounds.height,h=t.geo.reaspect(this._getBbox(e,i),a,!0),c=t.geo.reaspect(this._getBboxMax(),a,!0);return Math.round(Math.log(t.geo.width(c,!0)/t.geo.width(h,!0))/Math.log(this._fullZoomFactor))},_setZoom:function(t,e){this._clearInteractiveTimeout(),t=Math.min(Math.max(t,this._options.zoomMin),this._options.zoomMax),this._setInteractiveCenterAndSize(this._centerInteractive,this._getPixelSize(t)),this._interactiveTransform(),this._setInteractiveTimeout(e)},_createChildren:function(){this._$existingChildren=this._$elem.children(),this._forcePosition(this._$existingChildren),this._$existingChildren.detach().css({mozUserSelect:"none"});var i="width:"+this._contentBounds.width+"px; height:"+this._contentBounds.height+"px; margin:0; padding:0;",s="position:absolute; left:0; top:0;";this._$elem.prepend(e.toStaticHTML('<div class="geo-event-target geo-content-frame" style="position:absolute; left:'+this._contentBounds.x+"px; top:"+this._contentBounds.y+"px;"+i+'overflow:hidden; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none;" unselectable="on"></div>')),this._$eventTarget=this._$contentFrame=this._$elem.children(":first"),this._$contentFrame.append('<div class="geo-services-container" style="'+s+i+'"></div>'),this._$servicesContainer=this._$contentFrame.children(":last"),this._$contentFrame.append('<ul style="position: absolute; bottom: 8px; left: 8px; list-style-type: none; max-width: 50%; padding: 0; margin: 0;"></ul>'),this._$attrList=this._$contentFrame.children(":last"),this._$contentFrame.append('<div class="geo-draw-container" style="'+s+i+'"></div>'),this._$drawContainer=this._$contentFrame.children(":last"),this._$contentFrame.append('<div class="geo-measure-container" style="'+s+i+'"><span class="geo-measure-label" style="'+s+'; display: none;"></span></div>'),this._$measureContainer=this._$contentFrame.children(":last"),this._$measureLabel=this._$measureContainer.children(),this._$contentFrame.append('<div class="geo-shapes-container" style="'+s+i+'"></div>'),this._$shapesContainer=this._$contentFrame.children(":last"),this._$panContainer=t([this._$shapesContainer[0],this._$drawContainer[0],this._$measureContainer[0]]),this._$resizeContainer=t([this._$contentFrame[0],this._$servicesContainer[0],this._$eventTarget[0],this._$measureContainer[0]]),this._$contentFrame.append(this._$existingChildren),t("#geo-measure-style").length||t("head").prepend(e.toStaticHTML('<style type="text/css" id="geo-measure-style">.geo-measure-label { margin: 4px 0 0 6px; font-family: sans-serif;'+(o?"letter-spacing: 2px; color: #444; filter:progid:DXImageTransform.Microsoft.DropShadow(Color=white, OffX=1, OffY=2, Positive=true);":"color: #000; text-shadow: #fff 1px 2px; font-weight: bold;")+" }</style>"))},_createServices:function(){var i,s;for(s=0;this._currentServices.length>s;s++)this._currentServices[s].serviceContainer.geomap("destroy"),t.geo._serviceTypes[this._currentServices[s].type].destroy(this,this._$servicesContainer,this._currentServices[s]);for(this._currentServices=[],this._$servicesContainer.html(""),this._$attrList.html(""),s=0;this._options.services.length>s;s++){i=this._currentServices[s]=t.extend({},this._options.services[s]),i.serviceObject=this._options.services[s],i.style=t.extend({visibility:"visible",opacity:1},i.style);var o,n=i.id?' id="'+i.id+'"':"",r='class="geo-service '+(i["class"]?i["class"]:"")+'"',a="<div "+n+r+' style="-webkit-transform:translateZ(0);position:absolute; left:0; top:0; width:32px; height:32px; margin:0; padding:0; display:'+("visible"===i.style.visibility?"block":"none")+';"></div>';this._$servicesContainer.append(e.toStaticHTML(a)),o=this._$servicesContainer.children(":last"),i.serviceContainer=o,t.geo._serviceTypes[i.type].create(this,o,i,s),o.data("geoMap",this).geomap(),i.attr&&this._$attrList.append("<li>"+i.attr+"</li>")
}this._$shapesContainers=this._$shapesContainer,this._$attrList.find("a").css({position:"relative",zIndex:1,display:"inline-block",webkitTransform:"translateZ(0)"})},_createServiceGraphics:function(){var t=this._$elem.closest(".geo-content-frame");this._$elem.append('<div class="geo-shapes-container" style="position:absolute; left:0; top:0; width:'+t.css("width")+"; height:"+t.css("height")+'; margin:0; padding:0;"></div>'),this._$shapesContainer=this._$elem.children(":last"),this._map._$shapesContainers=this._map._$shapesContainers.add(this._$shapesContainer),this._$shapesContainer.geographics(),this._createdGraphics=!0,this._options.shapeStyle=this._$shapesContainer.geographics("option","style")},_refreshDrawing:function(){if(this._$drawContainer.geographics("clear"),this._drawPixels.length>0){var e,i,s,o,n,r=this._options.mode,a=this._drawPixels,h=this._drawCoords;switch(r){case"measureLength":r="drawLineString",i={type:"LineString",coordinates:h},e=t.render[this._tmplLengthId]({length:t.geo.length(i,!0)}),s=t.merge([],a[a.length-1]);break;case"measureArea":r="drawPolygon",i={type:"Polygon",coordinates:[t.merge([],h)]},i.coordinates[0].push(h[0]),e=t.render[this._tmplAreaId]({area:t.geo.area(i,!0)}),s=this._toPixel(t.geo.centroid(i).coordinates),a=[a];break;case"drawPolygon":a=[a]}this._$drawContainer.geographics(r,a),e&&(this._$measureLabel.html(e),o=this._contentBounds.width-(this._$measureLabel.outerWidth(!0)+s[0]),n=this._contentBounds.height-(this._$measureLabel.outerHeight(!0)+s[1]),0>o&&(s[0]+=o),0>n&&(s[1]+=n),this._$measureLabel.css({left:Math.max(s[0],0),top:Math.max(s[1],0)}).show())}},_resetDrawing:function(){this._drawPixels=[],this._drawCoords=[],this._$drawContainer.geographics("clear"),this._$measureLabel.hide()},_refreshAllShapes:function(){this._timeoutRefreshShapes=null;for(var t,e,i=0;this._currentServices.length>i;i++)t=this._currentServices[i],e=t.serviceContainer.data("geoService"),e._createdGraphics&&(e._$shapesContainer.geographics("clear"),e._graphicShapes.length>0&&e._refreshShapes(e._$shapesContainer,e._graphicShapes,e._graphicShapes,e._graphicShapes));this._createdGraphics&&(this._$shapesContainer.geographics("clear"),this._graphicShapes.length>0&&this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes))},_refreshShapes:function(e,s,o,n,r,a){var h,c,l,_,u,d,p,g,m,f=this._map._getBbox(r,a);for(h=0;s.length>h;h++)if(l=s[h].shape||s[h],l=l.geometry||l,_=t.data(l,"geoBbox"),!_||!t.geo._bboxDisjoint(f,_)){switch(u=t.isArray(o)?o[h].style:o,d=t.isArray(n)?n[h].label:n,p=d!==i,g=i,m=t.geo.centroid(l),l.type){case"Point":g=this._map.toPixel(l.coordinates,r,a),this._$shapesContainer.geographics("drawPoint",g,u);break;case"LineString":this._$shapesContainer.geographics("drawLineString",this._map.toPixel(l.coordinates,r,a),u),p&&(g=this._map.toPixel(t.geo.pointAlong(l,.5).coordinates,r,a));break;case"Polygon":this._$shapesContainer.geographics("drawPolygon",this._map.toPixel(l.coordinates,r,a),u),p&&m&&(g=this._map.toPixel(m.coordinates,r,a));break;case"MultiPoint":for(c=0;l.coordinates.length>c;c++)this._$shapesContainer.geographics("drawPoint",this._map.toPixel(l.coordinates[c],r,a),u);p&&m&&(g=this._map.toPixel(m.coordinates,r,a));break;case"MultiLineString":for(c=0;l.coordinates.length>c;c++)this._$shapesContainer.geographics("drawLineString",this._map.toPixel(l.coordinates[c],r,a),u);p&&m&&(g=this._map.toPixel(m.coordinates,r,a));break;case"MultiPolygon":for(c=0;l.coordinates.length>c;c++)this._$shapesContainer.geographics("drawPolygon",this._map.toPixel(l.coordinates[c],r,a),u);p&&m&&(g=this._map.toPixel(m.coordinates,r,a));break;case"GeometryCollection":this._refreshShapes(e,l.geometries,u,d,r,a)}p&&g&&this._$shapesContainer.geographics("drawLabel",g,d)}},_findMapSize:function(){for(var t={width:0,height:0},e=this._$elem;e.size()&&!(t.width>0&&t.height>0);)t={width:e.width(),height:e.height()},(0>=t.width||0>=t.height)&&(t={width:parseInt(e.css("width"),10),height:parseInt(e.css("height"),10)}),e=e.parent();return t},_forcePosition:function(t){var e=t.css("position");"relative"!==e&&"absolute"!==e&&"fixed"!==e&&t.css("position","relative")},_getPixelSize:function(e){var i=this._options.tilingScheme;if(null!==i){if(0===e)return i.pixelSizes?i.pixelSizes[0]:i.basePixelSize;e=Math.round(e),e=Math.max(e,0);var s=i.pixelSizes?i.pixelSizes.length:i.levels;return e=Math.min(e,s-1),i.pixelSizes?i.pixelSizes[e]:i.basePixelSize/Math.pow(2,e)}var o=t.geo.scaleBy(this._getBboxMax(),1/Math.pow(this._fullZoomFactor,e),!0);return Math.max(t.geo.width(o,!0)/this._contentBounds.width,t.geo.height(o,!0)/this._contentBounds.height)},_getZoomCenterAndSize:function(t,e,i){var s=i?this._fullZoomFactor:this._partialZoomFactor,o=Math.pow(s,-e),n=this._pixelSizeInteractive*o;n=Math.min(Math.max(n,this._pixelSizeMin),this._pixelSizeMax);var r=this._getZoom(this._centerInteractive,n);i&&this._options.tilingScheme?n=this._getPixelSize(Math.min(Math.max(r,this._options.zoomMin),this._options.zoomMax)):0>e&&this._options.zoomMin>r?n=this._pixelSizeInteractive:e>0&&r>this._options.zoomMax&&(n=this._pixelSizeInteractive);var a=n/this._pixelSizeInteractive,h=this._toMap(t,this._centerInteractive,this._pixelSizeInteractive),c=[(this._centerInteractive[0]-h[0])*a,(this._centerInteractive[1]-h[1])*a],l=[h[0]+c[0],h[1]+c[1]];return{pixelSize:n,center:l}},_panFinalize:function(){this._panning&&(this._velocity=[0,0],this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]),this._inOp=!1,this._anchor=this._current,this._mouseDown=this._toolPan=this._panning=!1)},_panMove:function(){if(this._options.pannable){var t=this._current[0]-this._lastDrag[0],e=this._current[1]-this._lastDrag[1];(this._toolPan||t>3||-3>t||e>3||-3>e)&&(this._toolPan||(this._toolPan=!0,this._$eventTarget.css("cursor",this._options.cursors.pan)),this._mouseDown&&(this._velocity=[t,e]),(0!==t||0!==e)&&(this._panning=!0,this._lastDrag=this._current,this._centerInteractive[0]-=t*this._pixelSizeInteractive,this._centerInteractive[1]+=("image"===this._options.axisLayout?-1:1)*e*this._pixelSizeInteractive,this._setInteractiveCenterAndSize(this._centerInteractive,this._pixelSizeInteractive),this._interactiveTransform()))}},_clearInteractiveTimeout:function(){return this._timeoutRefreshShapes&&(clearTimeout(this._timeoutRefreshShapes),this._timeoutRefreshShapes=null),this._timeoutInteractive?(clearTimeout(this._timeoutInteractive),this._timeoutInteractive=null,!0):(this._centerInteractive[0]=this._center[0],this._centerInteractive[1]=this._center[1],this._pixelSizeInteractive=this._pixelSize,!1)},_interactiveTransform:function(){var e,i=this._pixelSize,s=i/this._pixelSizeInteractive;if(i>0){s=Math.round(1e3*s)/1e3;var o=this._toMap([0,0]),n=this._toPixel(o,this._centerInteractive,this._pixelSizeInteractive);this._$shapesContainers.geographics("interactiveTransform",n,s)}for(var r=0;this._currentServices.length>r;r++)e=this._currentServices[r],t.geo._serviceTypes[e.type].interactiveTransform(this,e,this._centerInteractive,this._pixelSizeInteractive);this._drawCoords.length>0&&(this._drawPixels=this._toPixel(this._drawCoords,this._centerInteractive,this._pixelSizeInteractive),this._refreshDrawing())},_interactiveTimeout:function(){this._isMultiTouch?this._timeoutInteractive=setTimeout(t.proxy(this._interactiveTimeout,this),128):this._created&&this._timeoutInteractive&&(this._setCenterAndSize(this._centerInteractive,this._pixelSizeInteractive,this._triggerInteractive,!0),this._timeoutInteractive=null,this._triggerInteractive=!1,this._timeoutRefreshShapes=setTimeout(t.proxy(this._refreshAllShapes,this),128))},_setInteractiveTimeout:function(e){this._timeoutInteractive=setTimeout(t.proxy(this._interactiveTimeout,this),128),this._triggerInteractive|=e},_refresh:function(e,i){for(var s,o=0;this._currentServices.length>o;o++)s=this._currentServices[o],i&&s.serviceContainer[0]!==i[0]||t.geo._serviceTypes[s.type].refresh(this,s,e)},_setInteractiveCenterAndSize:function(e,i){this._centerInteractive[0]=e[0],this._centerInteractive[1]=e[1],this._pixelSizeInteractive=i,this._userGeodetic?(this._options.bbox=t.geo.proj.toGeodetic(this._getBbox(e,i)),this._options.center=t.geo.proj.toGeodetic(e)):(this._options.bbox=this._getBbox(e,i),this._options.center[0]=e[0],this._options.center[1]=e[1]),this._options.pixelSize=i,this._options.zoom=this._getZoom(e,i)},_setCenterAndSize:function(i,s,o,n){if(t.isArray(i)&&2===i.length&&"number"==typeof i[0]&&"number"==typeof i[1]){var r=this._getZoom(i,s);this._options.tilingScheme?this._pixelSizeInteractive=s=this._getPixelSize(Math.min(Math.max(r,this._options.zoomMin),this._options.zoomMax)):this._options.zoomMin>r?this._pixelSizeInteractive=s=this._getPixelSize(this._options.zoomMin):r>this._options.zoomMax&&(this._pixelSizeInteractive=s=this._getPixelSize(this._options.zoomMax)),this._centerInteractive[0]=i[0],this._centerInteractive[1]=i[1],this._created&&this._interactiveTransform(),this._options.pixelSize=this._pixelSize=s,this._center[0]=i[0],this._center[1]=i[1],this._userGeodetic?(this._options.bbox=t.geo.proj.toGeodetic(this._getBbox()),this._options.center=t.geo.proj.toGeodetic(this._center)):(this._options.bbox=this._getBbox(),this._options.center=t.merge([],i)),this._options.zoom=r,o&&this._trigger("bboxchange",e.event,{bbox:t.merge([],this._options.bbox)}),n&&(this._refresh(),this._refreshAllShapes(),this._refreshDrawing())}},_requestQueued:function(){0===this._loadCount&&this._trigger("loadstart",e.event),this._loadCount++},_requestComplete:function(){this._loadCount--,0>=this._loadCount&&(this._loadCount=0,this._trigger("loadend",e.event))},_toMap:function(e,i,s){i=i||this._center,s=s||this._pixelSize;var o,n,r,a,h=t.isArray(e[0]),c=h&&t.isArray(e[0][0]),l=c&&t.isArray(e[0][0][0]),_=this._contentBounds.width,u=this._contentBounds.height,d=_/2*s,p=u/2*s,g=[i[0]-d,i[1]-p,i[0]+d,i[1]+p],m=t.geo.width(g,!0)/_,f=t.geo.height(g,!0)/u,v="image"===this._options.axisLayout,x=[];for(l||(c||(h||(e=[e]),e=[e]),e=[e]),n=0;e.length>n;n++)for(x[n]=[],r=0;e[n].length>r;r++)for(x[n][r]=[],a=0;e[n][r].length>a;a++)o=e[n][r][a][1]*f,x[n][r][a]=[g[0]+e[n][r][a][0]*m,v?g[1]+o:g[3]-o];return l?x:c?x[0]:h?x[0][0]:x[0][0][0]},_toPixel:function(e,i,s){i=i||this._center,s=s||this._pixelSize;var o,n,r,a=t.isArray(e[0]),h=a&&t.isArray(e[0][0]),c=h&&t.isArray(e[0][0][0]),l=this._contentBounds.width,_=this._contentBounds.height,u=l/2*s,d=_/2*s,p=[i[0]-u,i[1]-d,i[0]+u,i[1]+d],g=t.geo.width(p,!0),m=t.geo.height(p,!0),f="image"===this._options.axisLayout,v=l/g,x=_/m,y=[];for(c||(h||(a||(e=[e]),e=[e]),e=[e]),o=0;e.length>o;o++)for(y[o]=[],n=0;e[o].length>n;n++)for(y[o][n]=[],r=0;e[o][n].length>r;r++)y[o][n][r]=[Math.round((e[o][n][r][0]-p[0])*v),Math.round((f?e[o][n][r][1]-p[1]:p[3]-e[o][n][r][1])*x)];return c?y:h?y[0]:a?y[0][0]:y[0][0][0]},_document_keydown:function(e){var i=this._drawCoords.length;i>0&&27===e.which&&(2>=i?(this._resetDrawing(),this._inOp=!1):(this._drawCoords[i-2]=t.merge([],this._drawCoords[i-1]),this._drawPixels[i-2]=t.merge([],this._drawPixels[i-1]),this._drawCoords.length--,this._drawPixels.length--,this._refreshDrawing()))},_eventTarget_dblclick_zoom:function(t){var e=this._clearInteractiveTimeout();if(this._trigger("dblclick",t,{type:"Point",coordinates:this._toMap(this._current,this._centerInteractive,this._pixelSizeInteractive)}),!t.isDefaultPrevented()){var i=this._getZoomCenterAndSize(this._current,1,!0);this._setInteractiveCenterAndSize(i.center,i.pixelSize),this._interactiveTransform(),e=!0}e&&this._setInteractiveTimeout(!0)},_eventTarget_dblclick:function(i){if("static"!==this._options.mode){switch(this._drawTimeout&&(e.clearTimeout(this._drawTimeout),this._drawTimeout=null),this._options.mode){case"drawLineString":case"measureLength":this._drawCoords.length>1&&(this._drawCoords[0][0]!==this._drawCoords[1][0]||this._drawCoords[0][1]!==this._drawCoords[1][1])?(this._drawCoords.length--,this._trigger("shape",i,{type:"LineString",coordinates:this._userGeodetic?t.geo.proj.toGeodetic(this._drawCoords):this._drawCoords})):this._eventTarget_dblclick_zoom(i),this._resetDrawing();break;case"drawPolygon":case"measureArea":if(this._drawCoords.length>1&&(this._drawCoords[0][0]!==this._drawCoords[1][0]||this._drawCoords[0][1]!==this._drawCoords[1][1])){var s=this._drawCoords.length-1;s>2&&(this._drawCoords[s]=t.merge([],this._drawCoords[0]),this._trigger("shape",i,{type:"Polygon",coordinates:[this._userGeodetic?t.geo.proj.toGeodetic(this._drawCoords):this._drawCoords]}))}else this._eventTarget_dblclick_zoom(i);this._resetDrawing();break;default:this._eventTarget_dblclick_zoom(i)}this._inOp=!1}},_eventTarget_touchstart:function(e){if(document.elementFromPoint!==i){var s=document.elementFromPoint(e.pageX,e.pageY);if(s&&"A"===s.nodeName)return}var o=this._options.mode,n=this._options.shift,r="dragBox"===o?"dragBox":"zoom";if("static"!==o&&(this._supportTouch||1===e.which)){var a=this._clearInteractiveTimeout(),h=t(e.currentTarget).offset(),c=e.originalEvent.changedTouches;if(this._supportTouch&&c?(this._multiTouchAnchor=t.merge([],c),this._isMultiTouch=this._multiTouchAnchor.length>1,this._isMultiTouch?(this._multiTouchCurrentBbox=[c[0].pageX-h.left,c[0].pageY-h.top,c[1].pageX-h.left,c[1].pageY-h.top],this._multiTouchAnchorBbox=t.merge([],this._multiTouchCurrentBbox),this._current=t.geo.center(this._multiTouchCurrentBbox,!0)):(this._multiTouchCurrentBbox=[c[0].pageX-h.left,c[0].pageY-h.top,0/0,0/0],this._current=[c[0].pageX-h.left,c[0].pageY-h.top])):this._current=[e.pageX-h.left,e.pageY-h.top],this._softDblClick){var l=t.now();if(750>l-this._downDate){if(this._isTap){var _=this._current[0]-this._anchor[0],u=this._current[1]-this._anchor[1],d=Math.sqrt(_*_+u*u);d>8?this._isTap=!1:this._current=t.merge([],this._anchor)}this._isDbltap=this._isDbltap?!1:this._isTap}else this._isDbltap=!1;this._isTap=!0,this._downDate=l}return this._mouseDown=!0,this._anchor=t.merge([],this._current),!this._inOp&&e.shiftKey&&"off"!==n?(this._shiftDown=!0,this._$eventTarget.css("cursor",this._options.cursors["default"===n?r:n])):this._isMultiTouch||!this._options.pannable&&"dragBox"!==o&&"dragCircle"!==o||(this._inOp=!0,"zoom"!==o&&"dragBox"!==o&&"dragCircle"!==o&&(this._lastDrag=this._current,e.currentTarget.setCapture&&e.currentTarget.setCapture())),e.preventDefault(),a&&this._setInteractiveTimeout(!0),!1}},_dragTarget_touchmove:function(e){if("static"!==this._options.mode){var s=!1;this._mouseDown&&(s=this._clearInteractiveTimeout());var n,r=this._$eventTarget.offset(),a=this._drawCoords.length,h=e.originalEvent.changedTouches,c=0;if(this._supportTouch&&h){if(!this._isMultiTouch&&this._mouseDown&&this._multiTouchAnchor.length>0&&h[0].identifier!==this._multiTouchAnchor[0].identifier)return this._mouseDown=!1,this._isMultiTouch=!0,this._wheelLevel=0,this._multiTouchAnchor.push(h[0]),this._multiTouchCurrentBbox=[this._multiTouchCurrentBbox[0],this._multiTouchCurrentBbox[1],this._multiTouchAnchor[1].pageX-r.left,this._multiTouchAnchor[1].pageY-r.top],this._multiTouchAnchorBbox=t.merge([],this._multiTouchCurrentBbox),this._mouseDown=!0,this._anchor=this._current=t.geo.center(this._multiTouchCurrentBbox,!0),s&&this._setInteractiveTimeout(!0),!1;if(this._isMultiTouch){for(;h.length>c;c++)h[c].identifier===this._multiTouchAnchor[0].identifier?(this._multiTouchCurrentBbox[0]=h[c].pageX-r.left,this._multiTouchCurrentBbox[1]=h[c].pageY-r.top):h[c].identifier===this._multiTouchAnchor[1].identifier&&(this._multiTouchCurrentBbox[2]=h[c].pageX-r.left,this._multiTouchCurrentBbox[3]=h[c].pageY-r.top);var l=t.geo._distancePointPoint([this._multiTouchAnchorBbox[0],this._multiTouchAnchorBbox[1]],[this._multiTouchAnchorBbox[2],this._multiTouchAnchorBbox[3]]),_=t.geo._distancePointPoint([this._multiTouchCurrentBbox[0],this._multiTouchCurrentBbox[1]],[this._multiTouchCurrentBbox[2],this._multiTouchCurrentBbox[3]]);n=t.geo.center(this._multiTouchCurrentBbox,!0);var u=(_-l)/l;u*=u>0?5:10;var d=u-this._wheelLevel;this._wheelLevel=u;var p=this._getZoomCenterAndSize(this._anchor,d,!1);this._setInteractiveCenterAndSize(p.center,p.pixelSize),this._interactiveTransform(),s=!0,n=t.geo.center(this._multiTouchCurrentBbox,!0)}else n=[e.originalEvent.changedTouches[0].pageX-r.left,e.originalEvent.changedTouches[0].pageY-r.top]}else n=[e.pageX-r.left,e.pageY-r.top];if(n[0]===this._lastMove[0]&&n[1]===this._lastMove[1])return this._inOp?(e.preventDefault(),s&&this._setInteractiveTimeout(!0),!1):!1;if(7===o&&(this._isDbltap=this._isTap=!1),this._mouseDown&&(this._current=n,this._moveDate=t.now()),this._isMultiTouch)return e.preventDefault(),this._isDbltap=this._isTap=!1,s&&this._setInteractiveTimeout(!0),!1;var g,m,f,v=this._options.mode,x=this._options.shift,y="dragBox"===v?"dragBox":"zoom";switch(this._shiftDown&&(v="default"===x?y:x),v){case"zoom":case"dragBox":this._mouseDown?(this._$drawContainer.geographics("clear"),this._$drawContainer.geographics("drawBbox",[this._anchor[0],this._anchor[1],n[0],n[1]])):this._trigger("move",e,{type:"Point",coordinates:this.toMap(n)});break;case"dragCircle":this._mouseDown?(g=n[0]-this._anchor[0],m=n[1]-this._anchor[1],f=2*Math.sqrt(g*g+m*m),this._$drawContainer.geographics("clear"),this._$drawContainer.geographics("drawArc",this._anchor,0,360,{width:f,height:f})):this._trigger("move",e,{type:"Point",coordinates:this.toMap(n)});break;case"drawLineString":case"drawPolygon":case"measureLength":case"measureArea":this._mouseDown||this._toolPan?(this._panMove(),s=!0):(a>0&&(this._drawCoords[a-1]=this._toMap(n,this._centerInteractive,this._pixelSizeInteractive),this._drawPixels[a-1]=n,this._refreshDrawing()),this._trigger("move",e,{type:"Point",coordinates:this.toMap(n)}));break;default:this._mouseDown||this._toolPan?(this._panMove(),s=!0):this._trigger("move",e,{type:"Point",coordinates:this.toMap(n)})}return this._lastMove=n,s&&this._setInteractiveTimeout(!0),this._inOp?(e.preventDefault(),!1):i}},_dragTarget_touchstop:function(s){if("static"!==this._options.mode){if(!this._mouseDown){if(7!==o)return;this._eventTarget_touchstart(s)}var n,r,a,h,c,l,_,u=this._clearInteractiveTimeout(),d=this._mouseDown,p=this._toolPan,g=this._$eventTarget.offset(),m=this._options.mode,f=this._options.shift,v="dragBox"===m?"dragBox":"zoom";if(this._shiftDown&&(m="default"===f?v:f),this._supportTouch&&s.originalEvent.changedTouches?(n=[s.originalEvent.changedTouches[0].pageX-g.left,s.originalEvent.changedTouches[0].pageY-g.top],this._multiTouchAnchor=[],this._inOp=!1):n=[s.pageX-g.left,s.pageY-g.top],this._softDblClick&&this._isTap&&(h=n[0]-this._anchor[0],c=n[1]-this._anchor[1],8>=Math.sqrt(h*h+c*c)&&(n=t.merge([],this._anchor))),h=n[0]-this._anchor[0],c=n[1]-this._anchor[1],this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]),this._shiftDown=this._mouseDown=this._toolPan=!1,this._isMultiTouch)return s.preventDefault(),this._isMultiTouch=!1,this._wheelLevel=0,u&&this._setInteractiveTimeout(!0),i;if(document.releaseCapture&&document.releaseCapture(),d){switch(a=t.now(),this._current=n,m){case"zoom":case"dragBox":if(0!==h||0!==c){var x=6*this._pixelSize,y=this._toMap([[Math.min(this._anchor[0],n[0]),Math.max(this._anchor[1],n[1])],[Math.max(this._anchor[0],n[0]),Math.min(this._anchor[1],n[1])]]),b=[y[0][0],y[0][1],y[1][0],y[1][1]];"zoom"===m?(x>b[2]-b[0]&&x>b[3]-b[1]&&(b=t.geo.scaleBy(this._getBbox(t.geo.center(b,!0)),.5,!0)),this._setBbox(b,!0,!0),u=!0):(_=t.geo.polygonize(b,!0),_.bbox=b,this._userGeodetic&&(_.coordinates=t.geo.proj.toGeodetic(_.coordinates),_.bbox=t.geo.proj.toGeodetic(_.bbox)),this._trigger("shape",s,_))}else"dragBox"===m&&(l=this._toMap(n),_={type:"Point",coordinates:[l[0],l[1]],bbox:[l[0],l[1],l[0],l[1]]},this._userGeodetic&&(_.coordinates=t.geo.proj.toGeodetic(_.coordinates),_.bbox=t.geo.proj.toGeodetic(_.bbox)),this._trigger("shape",s,_));this._resetDrawing();break;case"dragCircle":if(0!==h||0!==c){var w,S="image"===this._options.axisLayout,A=Math.sqrt(h*h+c*c),C=180;for(this._drawPixels.length=C+1,r=0;C>r;r++)w=360*r/C*(Math.PI/180),this._drawPixels[r]=[this._anchor[0]+Math.cos(w)*A,this._anchor[1]+Math.sin(w)*A];this._drawPixels[C]=[this._drawPixels[0][0],this._drawPixels[0][1]],l=this._toMap([[this._anchor[0]-A,this._anchor[1]+(S?-A:A)],[this._anchor[0]+A,this._anchor[1]+(S?A:-A)]]),_={type:"Polygon",coordinates:[this._toMap(this._drawPixels)],bbox:[l[0][0],l[0][1],l[1][0],l[1][1]]},this._userGeodetic&&(_.coordinates=t.geo.proj.toGeodetic(_.coordinates),_.bbox=t.geo.proj.toGeodetic(_.bbox)),this._trigger("shape",s,_),this._resetDrawing()}else l=this._toMap(n),_={type:"Point",coordinates:[l[0],l[1]],bbox:[l[0],l[1],l[0],l[1]]},this._userGeodetic&&(_.coordinates=t.geo.proj.toGeodetic(_.coordinates),_.bbox=t.geo.proj.toGeodetic(_.bbox)),this._trigger("shape",s,_);break;case"drawPoint":if(this._drawTimeout&&(e.clearTimeout(this._drawTimeout),this._drawTimeout=null),p)this._panFinalize();else if(a-this._clickDate>100){var T=this;this._drawTimeout=setTimeout(function(){T._drawTimeout&&(T._trigger("shape",s,{type:"Point",coordinates:T.toMap(n)}),T._inOp=!1,T._drawTimeout=null)},250)}break;case"drawLineString":case"drawPolygon":case"measureLength":case"measureArea":p?this._panFinalize():(r=0===this._drawCoords.length?0:this._drawCoords.length-1,this._drawCoords[r]=this._toMap(n),this._drawPixels[r]=n,(2>r||this._drawCoords[r][0]!==this._drawCoords[r-1][0]||this._drawCoords[r][1]!==this._drawCoords[r-1][1])&&(this._drawCoords[r+1]=this._toMap(n,this._centerInteractive,this._pixelSizeInteractive),this._drawPixels[r+1]=n),this._refreshDrawing());break;default:p?this._panFinalize():a-this._clickDate>100&&(this._trigger("click",s,{type:"Point",coordinates:this.toMap(n)}),this._inOp=!1)}if(this._clickDate=a,this._softDblClick&&this._isDbltap)return this._isDbltap=this._isTap=!1,u&&this._setInteractiveTimeout(!0),this._$eventTarget.trigger("dblclick",s),!1}return u&&this._setInteractiveTimeout(!0),this._inOp?(s.preventDefault(),!1):i}},_eventTarget_mousewheel:function(e,i){if("static"!==this._options.mode&&"off"!==this._options.scroll){if(e.preventDefault(),this._mouseDown)return!1;if(0!==i){var s=Math.abs(i)>=1;this._clearInteractiveTimeout(),i=i>0?Math.ceil(i):Math.floor(i);var o=t(e.currentTarget).offset();this._anchor=[e.pageX-o.left,e.pageY-o.top];var n=this._getZoomCenterAndSize(this._anchor,i,null!==this._options.tilingScheme?s:!1);this._setInteractiveCenterAndSize(n.center,n.pixelSize),this._interactiveTransform(),this._setInteractiveTimeout(!0)}return!1}}})}(jQuery,window),function(t,e,i){t.geo._serviceTypes.tiled=function(){var s=RegExp("<.*>|{{.*}}");return{_serviceId:0,_tmplGeoSrcId:"",create:function(i,s,o){this._serviceId=i._serviceIdSeed++,this._tmplGeoSrcId="geoSrc"+this._serviceId;var n=t.data(o,"geoServiceState");if(!n){n={loadCount:0,reloadTiles:!1};var r='<div data-geo-service="tiled" style="-webkit-transform:translateZ(0); position:absolute; left:0; top:0; width:8px; height:8px; margin:0; padding:0;"></div>';s.append(e.toStaticHTML(r)),n.serviceContainer=s.children(":last"),t.data(o,"geoServiceState",n)}return n.serviceContainer},destroy:function(e,i,s){var o=t.data(s,"geoServiceState");o.serviceContainer.remove(),t.removeData(s,"geoServiceState")},interactiveTransform:function(e,i,s,o){var n=t.data(i,"geoServiceState"),r=e.options.tilingScheme;n&&(this._cancelUnloaded(e,i),n.serviceContainer.children().each(function(){var i=t(this),n=i.data("pixelSize"),a=n/o;if(n>0){a=Math.round(1e3*a)/1e3;var h=i.data("scaleOrigin"),c=e._toPixel(h,s,o);i.css({left:Math.round(c[0])+"px",top:Math.round(c[1])+"px",width:r.tileWidth*a,height:r.tileHeight*a})}}))},refresh:function(i,o,n){var r=t.data(o,"geoServiceState");if(this._cancelUnloaded(i,o),r&&n&&(r.reloadTiles=!0),r&&o&&"visible"===o.style.visibility&&!r.serviceContainer.is(":hidden")){var a,h,c=i._getBbox(),l=i._pixelSize,_=this,u=r.serviceContainer,d="image"===i.options.axisLayout,p=d?1:-1,g=i.options.tilingScheme,m=g.tileWidth,f=g.tileHeight,v=Math.floor((c[0]-g.origin[0])/(l*m)),x=Math.max(Math.floor((d?c[1]-g.origin[1]:g.origin[1]-c[3])/(l*f)),0),y=Math.ceil((c[2]-g.origin[0])/(l*m)),b=Math.ceil((d?c[3]-g.origin[1]:g.origin[1]-c[1])/(l*f)),w=i._getBboxMax(),S=i._getPixelSize(0),A=S/l,C=Math.floor((w[0]-g.origin[0])/(S*m))*A,T=Math.floor((g.origin[1]+p*w[3])/(S*f))*A,M=g.origin[0]+C*m*l,P=g.origin[1]+p*T*f*l,$=Math.round((M-c[0])/l),z=Math.round((d?P-c[1]:c[3]-P)/l),I=u.children().show(),k=I.filter("[data-pixel-size='"+l+"']").appendTo(u),L=o.style.opacity,G=function(t){_._loadImage(this.img,t,l,i,r,L)},O=function(){delete this.img,r.loadCount--,i._requestComplete()};for(r.reloadTiles&&I.find("img").attr("data-dirty","true"),k.size()?(k.css({left:$%m+"px",top:z%f+"px"}).data("scaleOrigin",i._toMap([$%m,z%f])),k.children().each(function(){var e=t(this),i=e.attr("data-tile").split(",");e.css({left:Math.round(100*(parseInt(i[0],10)-C)+100*(($-$%m)/m))+"%",top:Math.round(100*(parseInt(i[1],10)-T)+100*((z-z%f)/f))+"%"}),1>L&&e.fadeTo(0,L)})):(u.append(e.toStaticHTML("<div style='-webkit-transform:translateZ(0);position:absolute; left:"+$%m+"px; top:"+z%f+"px; width:"+m+"px; height:"+f+"px; margin:0; padding:0;' data-pixel-size='"+l+"'></div>")),k=u.children(":last").data("scaleOrigin",i._toMap([$%m,z%f]))),a=v;y>a;a++)for(h=x;b>h;h++){var B=""+a+","+h,D=k.children("[data-tile='"+B+"']").removeAttr("data-dirty");if(0===D.size()||r.reloadTiles){var j,E=[g.origin[0]+a*m*l,g.origin[1]+p*h*f*l],F=[g.origin[0]+((a+1)*m-1)*l,g.origin[1]+p*((h+1)*f-1)*l],R=[E[0],E[1],F[0],F[1]],V=o.hasOwnProperty("src")?"src":"getUrl",N={bbox:R,width:m,height:f,zoom:i._getZoom(),tile:{row:h,column:a},index:Math.abs(h+a)},H=t.isFunction(o[V]);if(H?j=o[V](N):s.test(o[V])?(t.templates(this._tmplGeoSrcId,o[V]),j=t.render[this._tmplGeoSrcId](N)):j=o[V],r.loadCount++,i._requestQueued(),r.reloadTiles&&D.size()>0)D.attr("src",j);else{var W="<img style='-webkit-transform:translateZ(0);position:absolute; left:"+(100*(a-C)+100*(($-$%m)/m))+"%; "+"top:"+(100*(h-T)+100*((z-z%f)/f))+"%; ";W+="width: 100%; height: 100%;",W+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+B+"' />",k.append(e.toStaticHTML(W)),D=k.children(":last")}"string"==typeof j?_._loadImage(D,j,l,i,r,L):j&&t.isFunction(j.promise)?(t.extend(j.promise(),{img:D}),j.done(G).fail(O)):D.remove()}}I.find("[data-dirty]").remove(),r.reloadTiles=!1}},resize:function(){},opacity:function(e,i){var s=t.data(i,"geoServiceState");s.serviceContainer.find("img").stop(!0).fadeTo("fast",i.style.opacity)},toggle:function(e,i){var s=t.data(i,"geoServiceState");s.serviceContainer.css("display","visible"===i.style.visibility?"block":"none")},_cancelUnloaded:function(s,o){var n=t.data(o,"geoServiceState");if(n&&n.loadCount>0)for(e.stop!==i?e.stop():document.execCommand!==i&&document.execCommand("Stop",!1),n.serviceContainer.find("img:hidden").remove();n.loadCount>0;)n.loadCount--,s._requestComplete()},_loadImage:function(e,i,s,o,n,r){var a=n.serviceContainer;e.load(function(e){1>r?t(e.target).fadeTo(0,r):t(e.target).show(),n.loadCount--,o._requestComplete(),0>=n.loadCount&&(a.children(":not([data-pixel-size='"+s+"'])").remove(),n.loadCount=0)}).error(function(e){t(e.target).remove(),n.loadCount--,o._requestComplete(),0>=n.loadCount&&(a.children(":not([data-pixel-size='"+s+"'])").remove(),n.loadCount=0)}).attr("src",i)}}}()}(jQuery,window),function(t,e){t.geo._serviceTypes.shingled=function(){var i=RegExp("<.*>|{{.*}}");return{_serviceId:0,_tmplGeoSrcId:"",create:function(i,s,o){this._serviceId=i._serviceIdSeed++,this._tmplGeoSrcId="geoSrc"+this._serviceId;var n=t.data(o,"geoServiceState");if(!n){n={loadCount:0};var r='<div data-geo-service="shingled" style="-webkit-transform:translateZ(0);position:absolute; left:0; top:0; width:16px; height:16px; margin:0; padding:0;"></div>';s.append(e.toStaticHTML(r)),n.serviceContainer=s.children(":last"),t.data(o,"geoServiceState",n)}return n.serviceContainer},destroy:function(e,i,s){var o=t.data(s,"geoServiceState");o.serviceContainer.remove(),t.removeData(s,"geoServiceState")},interactiveTransform:function(e,i,s,o){var n=t.data(i,"geoServiceState"),r=e._getContentBounds(),a=r.width,h=r.height;n&&(this._cancelUnloaded(e,i),n.serviceContainer.children().each(function(){var i=t(this),n=i.data("pixelSize"),r=n/o;if(n>0){r=Math.round(1e3*r)/1e3;var c=i.data("origin"),l=e._toPixel(c,s,o);i.css({left:Math.round(l[0]),top:Math.round(l[1]),width:a*r,height:h*r})}}))},refresh:function(s,o){var n=t.data(o,"geoServiceState");if(this._cancelUnloaded(s,o),n&&o&&"visible"===o.style.visibility&&!n.serviceContainer.is(":hidden")){var r,a=s._getBbox(),h=s._pixelSize,c=this,l=n.serviceContainer,_=s._getContentBounds(),u=_.width,d=_.height,p=l.children('[data-pixel-size="'+h+'"]'),g=o.style.opacity;1>g&&l.find("img").attr("data-keep-alive","0"),p.size()||(l.append(e.toStaticHTML('<div style="-webkit-transform:translateZ(0);position:absolute; left:0px; top: 0px; width:'+u+"px; height:"+d+'px; margin:0; padding:0;" data-pixel-size="'+h+'" data-origin="['+s._toMap([0,0])+']"></div>')),p=l.children(":last"));var m,f=o.hasOwnProperty("src")?"src":"getUrl",v={bbox:a,width:u,height:d,zoom:s._getZoom(),tile:null,index:0},x=t.isFunction(o[f]),y=p.position();y.left=-y.left,y.top=-y.top,x?m=o[f](v):i.test(o[f])?(t.templates(this._tmplGeoSrcId,o[f]),m=t.render[this._tmplGeoSrcId](v)):m=o[f],n.loadCount++,s._requestQueued(),p.append(e.toStaticHTML('<img style="-webkit-transform:translateZ(0);position:absolute; left:'+100*(y.left/p.width())+"%; top:"+100*(y.top/p.height())+'%; width:100%; height:100%; margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;" unselectable="on" />')),r=p.children(":last").data("center",s._center),"string"==typeof m?c._loadImage(r,m,h,s,n,g):m.done(function(t){c._loadImage(r,t,h,s,n,g)}).fail(function(){r.remove(),n.loadCount--,s._requestComplete()})}},resize:function(e,i){var s=t.data(i,"geoServiceState");if(s&&i&&"visible"===i.style.visibility){this._cancelUnloaded(e,i);var o=s.serviceContainer,n=e._getContentBounds(),r=n.width,a=n.height,h=o.children();h.attr("data-pixel-size","0"),h.each(function(){var e=t(this),i=e.position();e.css({left:i.left+(r-e.width())/2,top:i.top+(a-e.height())/2})})}},opacity:function(e,i){var s=t.data(i,"geoServiceState");s.serviceContainer.find("img").stop(!0).fadeTo("fast",i.style.opacity)},toggle:function(e,i){var s=t.data(i,"geoServiceState");s.serviceContainer.css("display","visible"===i.style.visibility?"block":"none")},_cancelUnloaded:function(e,i){var s=t.data(i,"geoServiceState");if(s&&s.loadCount>0)for(s.serviceContainer.find("img:hidden").remove();s.loadCount>0;)s.loadCount--,e._requestComplete()},_loadImage:function(e,i,s,o,n,r){var a=n.serviceContainer;e.load(function(e){t.contains(document.body,e.target.jquery?e.target[0]:e.target)&&(1>r?t(e.target).fadeTo(0,r):t(e.target).show(),n.loadCount--,o._requestComplete(),0>=n.loadCount&&(a.children(':not([data-pixel-size="'+s+'"])').remove(),a.find("img[data-keep-alive]").remove(),n.loadCount=0))}).error(function(e){t.contains(document.body,e.target.jquery?e.target[0]:e.target)&&(t(e.target).remove(),n.loadCount--,o._requestComplete(),0>=n.loadCount&&(a.children(":not([data-pixel-size='"+s+"'])").remove(),n.loadCount=0))}).attr("src",i)}}}()}(jQuery,window);